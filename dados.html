<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MK-OSINT</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"></script>
    
    <link rel="icon" href="pr.png" type="image/x-icon" />
    <link rel="shortcut icon" href="pr.png" type="image/x-icon" />
    
    <style>
        :root {
            --primary: #00f3ff;
            --secondary: #9933ff;
            --background: #0a0e17;
            --panel: #121725;
            --text: #e0e0ff;
            --highlight: #ff00a5;
            --success: #00ff88;
            --warning: #ffcc00;
            --danger: #ff3366;
            --glass: rgba(18, 23, 37, 0.7);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Roboto', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background-color: var(--background);
            color: var(--text);
            overflow-x: hidden;
            position: relative;
            min-height: 100vh;
            width: 100%;
        }
        
        #background-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        
        .preloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--background);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            flex-direction: column;
        }
        
        .preloader__logo {
            width: 120px;
            height: 120px;
            border: 4px solid var(--primary);
            border-radius: 50%;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .preloader__logo::before {
            content: "";
            position: absolute;
            width: 70%;
            height: 70%;
            border: 3px solid var(--secondary);
            border-radius: 50%;
        }
        
        .preloader__logo::after {
            content: "MK";
            font-size: 24px;
            font-weight: 700;
            letter-spacing: 3px;
            color: var(--primary);
            text-shadow: 0 0 10px var(--primary);
        }
        
        .preloader__progress {
            width: 80%;
            max-width: 300px;
            height: 4px;
            background: rgba(255,255,255,0.1);
            margin-top: 40px;
            border-radius: 2px;
            overflow: hidden;
        }
        
        .preloader__bar {
            height: 100%;
            width: 0;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            box-shadow: 0 0 10px var(--primary);
            transition: width 0.5s ease;
        }
        
        .preloader__text {
            margin-top: 20px;
            font-size: 14px;
            opacity: 0.7;
        }
        
        .preloader__status {
            margin-top: 10px;
            font-size: 12px;
            opacity: 0.6;
        }
        
        header {
            padding: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 100;
            background: rgba(10, 14, 23, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255,255,255,0.05);
            width: 100%;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-shrink: 0;
        }
        
        .logo__icon {
            width: 36px;
            height: 36px;
            border: 2px solid var(--primary);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            flex-shrink: 0;
        }
        
        .logo__icon::before {
            content: "";
            position: absolute;
            width: 18px;
            height: 18px;
            border: 2px solid var(--secondary);
            border-radius: 50%;
        }
        
        .logo__text {
            font-size: 20px;
            font-weight: 700;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            letter-spacing: 1px;
        }
        
        .logo__text span {
            color: var(--text);
            opacity: 0.7;
            font-weight: 400;
            font-size: 12px;
            display: block;
            letter-spacing: normal;
            white-space: nowrap;
        }
        
        nav {
            display: flex;
            align-items: center;
            gap: 8px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            -ms-overflow-style: none;
            margin-right: 8px;
        }
        
        nav::-webkit-scrollbar {
            display: none;
        }
        
        .nav__item {
            padding: 6px 10px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            color: var(--text);
            text-decoration: none;
            white-space: nowrap;
            flex-shrink: 0;
        }
        
        .nav__item:hover, .nav__item.active {
            background: rgba(255,255,255,0.05);
        }
        
        .nav__item.active::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 16px;
            height: 3px;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            border-radius: 3px;
        }
        
        .user {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255,255,255,0.05);
            padding: 6px 10px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }
        
        .user:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .user__avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: 700;
            color: white;
            font-size: 14px;
        }
        
        .user__name {
            font-size: 13px;
            font-weight: 600;
            display: none;
        }
        
        .container {
            padding: 15px;
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            max-width: 1600px;
            margin: 0 auto;
            width: 100%;
        }
        
        .sidebar {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.05);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            height: fit-content;
            position: fixed;
            left: -100%;
            top: 0;
            bottom: 0;
            width: 260px;
            z-index: 200;
            transition: all 0.3s ease;
            overflow-y: auto;
        }
        
        .sidebar.active {
            left: 0;
        }
        
        .search {
            position: relative;
        }
        
        .search__input {
            width: 100%;
            padding: 10px 15px;
            padding-left: 40px;
            padding-right: 45px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            color: var(--text);
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .search__input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 243, 255, 0.2);
        }
        
        .search__icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255,255,255,0.3);
            font-size: 16px;
        }
        
        .search__button {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 243, 255, 0.1);
            border: none;
            color: var(--primary);
            border-radius: 8px;
            padding: 6px 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .search__button:hover {
            background: rgba(0, 243, 255, 0.2);
        }
        
        .search__spinner {
            position: absolute;
            right: 50px;
            top: 50%;
            transform: translateY(-50%);
            width: 16px;
            height: 16px;
            border: 2px solid rgba(0, 243, 255, 0.2);
            border-top-color: var(--primary);
            border-radius: 50%;
            display: none;
        }
        
        .search__spinner.active {
            display: block;
        }
        
        .menu__title {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: rgba(255,255,255,0.4);
            margin-bottom: 10px;
        }
        
        .menu__list {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .menu__item {
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text);
            text-decoration: none;
        }
        
        .menu__item:hover, .menu__item.active {
            background: rgba(255,255,255,0.05);
        }
        
        .menu__item.active {
            color: var(--primary);
            font-weight: 600;
        }
        
        .menu__icon {
            font-size: 16px;
            width: 20px;
            text-align: center;
        }
        
        .main-content {
            display: grid;
            grid-template-rows: auto 1fr;
            gap: 20px;
            width: 100%;
        }
        
        .page-header {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .page-title {
            font-size: 22px;
            font-weight: 700;
        }
        
        .page-subtitle {
            font-size: 14px;
            color: rgba(255,255,255,0.5);
            margin-top: -5px;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 8px 15px;
            border-radius: 10px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            border: none;
            white-space: nowrap;
        }
        
        .btn--primary {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 5px 15px rgba(0, 243, 255, 0.2);
        }
        
        .btn--primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 243, 255, 0.3);
        }
        
        .btn--outline {
            background: transparent;
            border: 1px solid rgba(255,255,255,0.1);
            color: var(--text);
        }
        
        .btn--outline:hover {
            background: rgba(255,255,255,0.05);
        }
        
        .btn__icon {
            font-size: 14px;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            width: 100%;
        }
        
        .card {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.05);
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            width: 100%;
        }
        
        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            border-color: rgba(255,255,255,0.1);
        }
        
        .card__header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .card__title {
            font-size: 16px;
            font-weight: 600;
        }
        
        .card__subtitle {
            font-size: 12px;
            color: rgba(255,255,255,0.5);
            margin-top: 4px;
        }
        
        .card__menu {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .card__menu:hover {
            background: rgba(255,255,255,0.05);
        }
        
        .card__content {
            flex: 1;
            width: 100%;
        }
        
        .stat-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            width: 100%;
        }
        
        .stat {
            padding: 15px;
            background: rgba(255,255,255,0.02);
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .stat__value {
            font-size: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .stat__label {
            font-size: 12px;
            color: rgba(255,255,255,0.5);
        }
        
        .stat__icon {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 18px;
            flex-shrink: 0;
        }
        
        .stat__icon--blue {
            background: rgba(0, 243, 255, 0.1);
            color: var(--primary);
        }
        
        .stat__icon--purple {
            background: rgba(153, 51, 255, 0.1);
            color: var(--secondary);
        }
        
        .stat__icon--green {
            background: rgba(0, 255, 136, 0.1);
            color: var(--success);
        }
        
        .stat__icon--yellow {
            background: rgba(255, 204, 0, 0.1);
            color: var(--warning);
        }
        
        .table-container {
            overflow-x: auto;
            width: 100%;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
            scrollbar-color: rgba(255,255,255,0.1) transparent;
            border-radius: 10px;
        }
        
        .table-container::-webkit-scrollbar {
            height: 6px;
        }
        
        .table-container::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .table-container::-webkit-scrollbar-thumb {
            background-color: rgba(255,255,255,0.1);
            border-radius: 10px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            min-width: 700px;
        }
        
        .data-table th {
            padding: 12px 15px;
            text-align: left;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: rgba(255,255,255,0.5);
            border-bottom: 1px solid rgba(255,255,255,0.05);
            position: sticky;
            top: 0;
            background: var(--panel);
            z-index: 10;
        }
        
        .data-table td {
            padding: 12px 15px;
            font-size: 13px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        
        .data-table tr:hover {
            background: rgba(255,255,255,0.02);
        }
        
        .data-table tr:last-child td {
            border-bottom: none;
        }
        
        .data-table__status {
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            display: inline-block;
        }
        
        .data-table__status--active {
            background: rgba(0, 255, 136, 0.1);
            color: var(--success);
        }
        
        .data-table__status--pending {
            background: rgba(255, 204, 0, 0.1);
            color: var(--warning);
        }
        
        .data-table__status--inactive {
            background: rgba(255, 51, 102, 0.1);
            color: var(--danger);
        }
        
        .data-table__actions {
            display: flex;
            gap: 8px;
        }
        
        .data-table__action {
            width: 28px;
            height: 28px;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        .data-table__action:hover {
            background: rgba(255,255,255,0.05);
        }
        
        .chart-container {
            position: relative;
            width: 100%;
            height: 250px;
        }
        
        .activity-feed {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .activity-item {
            display: flex;
            gap: 12px;
            padding: 12px;
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        
        .activity-item:hover {
            background: rgba(255,255,255,0.02);
        }
        
        .activity-item__icon {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 18px;
            flex-shrink: 0;
        }
        
        .activity-item__content {
            flex: 1;
            min-width: 0;
        }
        
        .activity-item__title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .activity-item__description {
            font-size: 13px;
            color: rgba(255,255,255,0.5);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .activity-item__time {
            font-size: 12px;
            color: rgba(255,255,255,0.3);
            margin-top: 4px;
        }
        
        .grid-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            width: 100%;
        }
        
        .profile-card {
            display: flex;
            flex-direction: column;
            gap: 15px;
            cursor: pointer;
        }
        
        .profile-card__header {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .profile-card__avatar {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: 700;
            color: white;
            font-size: 18px;
            flex-shrink: 0;
        }
        
        .profile-card__info {
            flex: 1;
            min-width: 0;
        }
        
        .profile-card__name {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .profile-card__details {
            font-size: 13px;
            color: rgba(255,255,255,0.5);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .profile-card__data {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .profile-card__data-item {
            padding: 10px;
            background: rgba(255,255,255,0.02);
            border-radius: 10px;
        }
        
        .profile-card__data-label {
            font-size: 12px;
            color: rgba(255,255,255,0.4);
            margin-bottom: 4px;
        }
        
        .profile-card__data-value {
            font-size: 14px;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 14, 23, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            padding: 15px;
        }
        
        .modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal__content {
            width: 100%;
            max-width: 1000px;
            max-height: 90vh;
            overflow-y: auto;
            background: var(--panel);
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.05);
            position: relative;
            transform: translateY(30px);
            opacity: 0;
            transition: all 0.3s ease;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
            scrollbar-color: rgba(255,255,255,0.1) transparent;
        }
        
        .modal__content::-webkit-scrollbar {
            width: 6px;
        }
        
        .modal__content::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .modal__content::-webkit-scrollbar-thumb {
            background-color: rgba(255,255,255,0.1);
            border-radius: 10px;
        }
        
        .modal.active .modal__content {
            transform: translateY(0);
            opacity: 1;
        }
        
        .modal__close {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(255,255,255,0.05);
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
        }
        
        .modal__close:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .modal__header {
            padding: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            position: relative;
        }
        
        .modal__title {
            font-size: 20px;
            font-weight: 700;
        }
        
        .modal__subtitle {
            font-size: 14px;
            color: rgba(255,255,255,0.5);
            margin-top: 4px;
        }
        
        .modal__body {
            padding: 20px;
        }
        
        .modal__footer {
            padding: 15px 20px;
            border-top: 1px solid rgba(255,255,255,0.05);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .profile-details {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }
        
        .profile-sidebar {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .profile-main {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .profile-image {
            width: 120px;
            height: 120px;
            border-radius: 20px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 60px;
            font-weight: 700;
            color: white;
            position: relative;
            overflow: hidden;
            margin: 0 auto;
        }
        
        .profile-image::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, rgba(0, 243, 255, 0.2), rgba(153, 51, 255, 0.2));
            mix-blend-mode: overlay;
        }
        
        .profile-summary {
            background: rgba(255,255,255,0.02);
            border-radius: 15px;
            padding: 15px;
        }
        
        .profile-summary__item {
            display: flex;
            flex-direction: column;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        
        .profile-summary__item:last-child {
            border-bottom: none;
        }
        
        .profile-summary__label {
            font-size: 12px;
            color: rgba(255,255,255,0.5);
            margin-bottom: 4px;
        }
        
        .profile-summary__value {
            font-size: 14px;
            font-weight: 600;
            word-break: break-word;
        }
        
        .connection-map {
            width: 100%;
            height: 250px;
            background: rgba(255,255,255,0.02);
            border-radius: 15px;
            position: relative;
            overflow: hidden;
        }
        
        .tab-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        .tabs::-webkit-scrollbar {
            display: none;
        }
        
        .tab {
            padding: 12px 15px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            white-space: nowrap;
        }
        
        .tab.active {
            color: var(--primary);
        }
        
        .tab.active::after {
            content: "";
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            border-radius: 3px 3px 0 0;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .timeline {
            position: relative;
            padding-left: 25px;
        }
        
        .timeline::before {
            content: "";
            position: absolute;
            top: 0;
            left: 8px;
            width: 2px;
            height: 100%;
            background: rgba(255,255,255,0.05);
        }
        
        .timeline-item {
            position: relative;
            padding-bottom: 20px;
        }
        
        .timeline-item:last-child {
            padding-bottom: 0;
        }
        
        .timeline-item::before {
            content: "";
            position: absolute;
            top: 0;
            left: -25px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--panel);
            border: 2px solid var(--primary);
            z-index: 1;
        }
        
        .timeline-item__date {
            font-size: 12px;
            color: rgba(255,255,255,0.5);
            margin-bottom: 8px;
        }
        
        .timeline-item__title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .timeline-item__description {
            font-size: 13px;
            color: rgba(255,255,255,0.7);
        }
        
        .badges {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            background: rgba(255,255,255,0.05);
        }
        
        .badge--blue {
            background: rgba(0, 243, 255, 0.1);
            color: var(--primary);
        }
        
        .badge--purple {
            background: rgba(153, 51, 255, 0.1);
            color: var(--secondary);
        }
        
        .badge--green {
            background: rgba(0, 255, 136, 0.1);
            color: var(--success);
        }
        
        .badge--yellow {
            background: rgba(255, 204, 0, 0.1);
            color: var(--warning);
        }
        
        .badge--red {
            background: rgba(255, 51, 102, 0.1);
            color: var(--danger);
        }
        
        .network-graph {
            width: 100%;
            height: 300px;
            background: rgba(255,255,255,0.02);
            border-radius: 15px;
            position: relative;
            overflow: hidden;
        }
        
        #network-canvas {
            width: 100%;
            height: 100%;
        }
        
        .floating-card {
            position: absolute;
            background: var(--glass);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.05);
            padding: 15px;
            max-width: 280px;
            display: none;
            z-index: 5;
        }
        
        .floating-card__title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .floating-card__item {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            font-size: 12px;
        }
        
        .floating-card__item:last-child {
            border-bottom: none;
        }
        
        .floating-card__label {
            color: rgba(255,255,255,0.5);
        }
        
        .loading {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 14, 23, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .loading.active {
            opacity: 1;
            visibility: visible;
        }
        
        .loading__spinner {
            width: 36px;
            height: 36px;
            border: 3px solid rgba(255,255,255,0.1);
            border-top-color: var(--primary);
            border-radius: 50%;
        }
        
        .notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--glass);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.05);
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 12px;
            width: calc(100% - 30px);
            max-width: 400px;
            z-index: 1000;
            opacity: 0;
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .notification.active {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
        
        .notification__icon {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 18px;
            flex-shrink: 0;
        }
        
        .notification__content {
            flex: 1;
            min-width: 0;
        }
        
        .notification__title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .notification__message {
            font-size: 12px;
            color: rgba(255,255,255,0.7);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .notification__close {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 20px;
            height: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-size: 14px;
            color: rgba(255,255,255,0.5);
        }
        
        .settings-section {
            margin-bottom: 25px;
        }
        
        .settings-section__title {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--primary);
        }
        
        .settings-group {
            background: rgba(255,255,255,0.02);
            border-radius: 10px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .settings-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        
        .settings-item:last-child {
            padding-bottom: 0;
            border-bottom: none;
        }
        
        .settings-item__label {
            font-size: 14px;
            font-weight: 600;
        }
        
        .settings-item__description {
            font-size: 12px;
            color: rgba(255,255,255,0.5);
            margin-top: 4px;
        }
        
        .toggle {
            position: relative;
            width: 46px;
            height: 24px;
            flex-shrink: 0;
        }
        
        .toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255,255,255,0.1);
            transition: .4s;
            border-radius: 34px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: var(--primary);
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(22px);
        }
        
        .settings-dropdown {
            position: relative;
            width: 150px;
            flex-shrink: 0;
        }
        
        .settings-dropdown select {
            width: 100%;
            padding: 8px 10px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            color: var(--text);
            font-size: 13px;
            appearance: none;
            cursor: pointer;
        }
        
        .settings-dropdown:after {
            content: "▼";
            font-size: 10px;
            color: rgba(255,255,255,0.5);
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
        }
        
        .classroom-btns {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        
        .classroom-btn {
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
            border: none;
            display: inline-block;
        }

        .classroom-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 243, 255, 0.3);
        }
        
        .mobile-menu-toggle {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            background: rgba(255,255,255,0.05);
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            flex-shrink: 0;
        }
        
        .mobile-menu-toggle span {
            display: block;
            width: 18px;
            height: 2px;
            background: var(--text);
            position: relative;
            transition: all 0.3s ease;
        }
        
        .mobile-menu-toggle span:before,
        .mobile-menu-toggle span:after {
            content: "";
            position: absolute;
            width: 100%;
            height: 100%;
            background: var(--text);
            transition: all 0.3s ease;
        }
        
        .mobile-menu-toggle span:before {
            top: -6px;
        }
        
        .mobile-menu-toggle span:after {
            bottom: -6px;
        }
        
        .mobile-menu-toggle.active span {
            background: transparent;
        }
        
        .mobile-menu-toggle.active span:before {
            top: 0;
            transform: rotate(45deg);
        }
        
        .mobile-menu-toggle.active span:after {
            bottom: 0;
            transform: rotate(-45deg);
        }
        
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 199;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .sidebar-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .search-result-item {
            margin-bottom: 15px;
            border-radius: 10px;
            background: rgba(255,255,255,0.03);
            padding: 15px;
            transition: all 0.3s ease;
            border-left: 3px solid var(--primary);
        }
        
        .search-result-item:hover {
            background: rgba(255,255,255,0.05);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .search-result-header {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--primary);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 8px;
        }
        
        .btn-add-profile {
            margin-top: 10px;
            font-size: 12px;
            padding: 6px 12px;
        }
        
        #file-search-type {
            background-color: rgba(255,255,255,0.1);
            color: white;
            font-weight: 500;
            padding: 10px 15px;
            border: 1px solid rgba(255,255,255,0.2);
            width: 100%;
        }
        
        #file-search-type option {
            background-color: var(--panel);
            color: white;
            padding: 10px;
        }
        
        .database-content {
            max-height: 60vh;
            overflow-y: auto;
            background: rgba(10, 14, 23, 0.5);
            border-radius: 10px;
            padding: 15px;
            font-family: monospace;
            font-size: 14px;
            line-height: 1.6;
            white-space: pre-wrap;
            margin-top: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .database-content::-webkit-scrollbar {
            width: 8px;
        }
        
        .database-content::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
        }
        
        .database-content::-webkit-scrollbar-thumb {
            background: rgba(0, 243, 255, 0.3);
            border-radius: 10px;
        }
        
        .database-content::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 243, 255, 0.5);
        }
        
        .database-search-container {
            position: sticky;
            top: 0;
            z-index: 10;
            background: var(--panel);
            padding: 10px 0;
            margin-bottom: 15px;
        }
        
        .database-search-input {
            width: 100%;
            padding: 10px 15px;
            padding-left: 40px;
            padding-right: 50px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(0, 243, 255, 0.3);
            border-radius: 8px;
            color: white;
            font-size: 14px;
        }
        
        .database-search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(0, 243, 255, 0.2);
        }
        
        .database-search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary);
        }

        .database-search-button {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            background: linear-gradient(to right, var(--primary), var(--secondary));
            border: none;
            color: white;
            border-radius: 6px;
            padding: 6px 12px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .database-search-button:hover {
            box-shadow: 0 0 10px rgba(0, 243, 255, 0.5);
        }
        
        .database-search-button:active {
            transform: translateY(-50%) scale(0.95);
        }
        
        .database-search-results {
            margin-top: 10px;
            padding: 8px 12px;
            background: rgba(0, 243, 255, 0.1);
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .highlight {
            background-color: rgba(255, 204, 0, 0.3);
            color: white;
            padding: 0 2px;
            border-radius: 3px;
        }
        
        .database-pagination {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            padding: 10px 0;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        
        .database-pagination-info {
            font-size: 13px;
            color: rgba(255,255,255,0.7);
        }
        
        .database-pagination-controls {
            display: flex;
            gap: 8px;
        }
        
        .database-pagination-btn {
            padding: 5px 12px;
            border-radius: 8px;
            font-size: 12px;
            background: rgba(255,255,255,0.05);
            color: var(--text);
            border: 1px solid rgba(255,255,255,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .database-pagination-btn:hover:not(:disabled) {
            background: rgba(0, 243, 255, 0.1);
            border-color: var(--primary);
        }
        
        .database-pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .database-pagination-select {
            padding: 5px 8px;
            border-radius: 8px;
            font-size: 12px;
            background: rgba(255,255,255,0.05);
            color: var(--text);
            border: 1px solid rgba(255,255,255,0.1);
            cursor: pointer;
        }
        
        .database-loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            font-size: 14px;
            color: rgba(255,255,255,0.7);
        }
        
        .database-loading .loading__spinner {
            width: 20px;
            height: 20px;
            margin-right: 10px;
        }
        
        .search-result-record {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(10, 14, 23, 0.7);
            border-left: 3px solid var(--primary);
            border-radius: 8px;
            white-space: pre-wrap;
            font-family: monospace;
            line-height: 1.5;
        }
        
        .full-record-container {
            margin-top: 15px;
            padding: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
            font-size: 13px;
            line-height: 1.5;
        }
        
        /* Animação de chuva otimizada */
        .raindrop {
            position: absolute;
            background: linear-gradient(to bottom, rgba(0, 243, 255, 0.1), rgba(0, 243, 255, 0.5));
            width: 2px;
            height: 15px;
            border-radius: 0 0 5px 5px;
            opacity: 0.7;
            pointer-events: none;
            z-index: 1;
            will-change: transform;
        }
        
        @media (min-width: 576px) {
            header {
                padding: 15px 20px;
            }
            
            .logo__icon {
                width: 40px;
                height: 40px;
            }
            
            .logo__text {
                font-size: 22px;
            }
            
            .user__name {
                display: block;
            }
            
            .container {
                padding: 20px;
            }
            
            .card {
                padding: 20px;
            }
            
            .profile-image {
                width: 150px;
                height: 150px;
                font-size: 70px;
            }
            
            .profile-summary__item {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
            
            .profile-summary__label {
                margin-bottom: 0;
            }
        }
        
        @media (min-width: 768px) {
            .container {
                padding: 25px;
            }
            
            .page-header {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
            
            .card__title {
                font-size: 18px;
            }
            
            .dashboard {
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
            }
            
            .card--lg {
                grid-column: span 2;
            }
            
            .stat-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .grid-container {
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
            }
            
            .profile-details {
                grid-template-columns: 250px 1fr;
            }
            
            .modal__header {
                padding: 25px;
            }
            
            .modal__body {
                padding: 25px;
            }
            
            .data-table {
                min-width: 0;
            }
            
            .notification {
                width: auto;
                max-width: 350px;
                right: 20px;
                left: auto;
                transform: translateX(0) translateY(100px);
            }
            
            .notification.active {
                transform: translateX(0) translateY(0);
            }
        }
        
        @media (min-width: 992px) {
            .container {
                grid-template-columns: 260px 1fr;
                gap: 25px;
                padding: 30px;
            }
            
            .sidebar {
                position: sticky;
                top: 100px;
                left: auto;
                padding: 25px;
                overflow-y: visible;
            }
            
            .mobile-menu-toggle {
                display: none;
            }
            
            .dashboard {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .card--lg {
                grid-column: span 3;
            }
            
            .card--md {
                grid-column: span 2;
            }
            
            .grid-container {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .connection-map {
                height: 300px;
            }
            
            .chart-container {
                height: 300px;
            }
        }
        
        @media (min-width: 1200px) {
            .container {
                padding: 40px;
                gap: 30px;
            }
            
            .sidebar {
                padding: 30px;
            }
            
            .profile-details {
                grid-template-columns: 300px 1fr;
                gap: 30px;
            }
            
            .grid-container {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        .fa {
            font-family: sans-serif;
        }
        
        .fa-search::before {
            content: "🔍";
        }
        
        .fa-dashboard::before {
            content: "📊";
        }
        
        .fa-users::before {
            content: "👥";
        }
        
        .fa-classroom::before {
            content: "🏫";
        }
        
        .fa-network::before {
            content: "🌐";
        }
        
        .fa-map::before {
            content: "🗺️";
        }
        
        .fa-file::before {
            content: "📄";
        }
        
        .fa-bell::before {
            content: "🔔";
        }
        
        .fa-settings::before {
            content: "⚙️";
        }
        
        .fa-logout::before {
            content: "🚪";
        }
        
        .fa-plus::before {
            content: "➕";
        }
        
        .fa-filter::before {
            content: "🔍";
        }
        
        .fa-user::before {
            content: "👤";
        }
        
        .fa-calendar::before {
            content: "📅";
        }
        
        .fa-location::before {
            content: "📍";
        }
        
        .fa-id::before {
            content: "🪪";
        }
        
        .fa-dots::before {
            content: "⋮";
        }
        
        .fa-edit::before {
            content: "✏️";
        }
        
        .fa-trash::before {
            content: "🗑️";
        }
        
        .fa-close::before {
            content: "✖";
        }
        
        .fa-check::before {
            content: "✓";
        }
        
        .fa-warning::before {
            content: "⚠️";
        }
        
        .fa-info::before {
            content: "ℹ️";
        }
        
        .fa-link::before {
            content: "🔗";
        }
        
        .fa-scan::before {
            content: "🔍";
        }
        
        .fa-database::before {
            content: "🗄️";
        }
        
        .fa-chart::before {
            content: "📈";
        }
        
        .fa-lock::before {
            content: "🔒";
        }
        
        .fa-unlock::before {
            content: "🔓";
        }
        
        .fa-shield::before {
            content: "🛡️";
        }
        
        .fa-notification::before {
            content: "🔔";
        }
        
        .fa-chevron-left::before {
            content: "◀";
        }
        
        .fa-chevron-right::before {
            content: "▶";
        }
    </style>
</head>
<body>
    <canvas id="background-canvas"></canvas>
    
    <div class="preloader">
        <div class="preloader__logo"></div>
        <div class="preloader__progress">
            <div class="preloader__bar" id="preloader-bar"></div>
        </div>
        <div class="preloader__text">Carregando sistema OSINT...</div>
        <div class="preloader__status" id="auth-status">Inicializando sistema...</div>
    </div>
    
    <header>
        <div class="mobile-menu-toggle" id="mobile-menu-toggle">
            <span></span>
        </div>
        
        <div class="logo">
            <div class="logo__icon"></div>
            <div class="logo__text">MK-OSINT <span>v1.5</span></div>
        </div>
        
        <nav>
            <a href="#" class="nav__item active" data-section="dashboard">Dashboard</a>
            <a href="#" class="nav__item" data-section="profiles">Perfis</a>
            <a href="#" class="nav__item" data-section="classrooms">Salas</a>
            <a href="#" class="nav__item" data-section="analysis">Análise</a>
            <a href="#" class="nav__item" data-section="reports">Relatórios</a>
            <div class="nav__item" id="notifications-btn">
                <i class="fa fa-bell"></i>
            </div>
        </nav>
        
        <div class="user" id="user-menu">
            <div class="user__avatar">B</div>
            <div class="user__name">Bloqueado</div>
        </div>
    </header>
    
    <div class="sidebar-overlay" id="sidebar-overlay"></div>
    
    <div class="container">
        <div class="sidebar" id="sidebar">
            
            <div class="menu">
                <div class="menu__title">Principal</div>
                <div class="menu__list">
                    <a href="#" class="menu__item active" data-section="dashboard">
                        <i class="fa fa-dashboard menu__icon"></i>
                        Dashboard
                    </a>
                    <a href="#" class="menu__item" data-section="classrooms">
                        <i class="fa fa-classroom menu__icon"></i>
                        Salas
                    </a>
                    <a href="#" class="menu__item" data-section="connections">
                        <i class="fa fa-network menu__icon"></i>
                        Conexões
                    </a>
                    <a href="#" class="menu__item" data-section="geolocation">
                        <i class="fa fa-map menu__icon"></i>
                        Geolocalização
                    </a>
                    <a href="#" class="menu__item" data-section="documents">
                        <i class="fa fa-file menu__icon"></i>
                        Documentos
                    </a>
                </div>
            </div>
            
            <div class="menu">
                <div class="menu__title">Sistema</div>
                <div class="menu__list">
                    <a href="#" class="menu__item" id="settings-btn">
                        <i class="fa fa-settings menu__icon"></i>
                        Configurações
                    </a>
                </div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="page-header">
                <div>
                    <h1 class="page-title">Dashboard</h1>
                    <div class="page-subtitle">Visão geral da base de dados</div>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn--primary" id="database-btn">
                        <i class="fa fa-database btn__icon"></i>
                        🔎Busca de Dados
                    </button>
                </div>
            </div>
            
            <div class="dashboard" id="dashboard-content">
                <div class="card">
                    <div class="card__header">
                        <div>
                            <div class="card__title">Estatísticas</div>
                            <div class="card__subtitle">Visão geral da base de dados</div>
                        </div>
                    </div>
                    <div class="card__content">
                        <div class="stat-grid">
                            <div class="stat">
                                <div class="stat__value" id="total-profiles">
                                    <div class="stat__icon stat__icon--blue">
                                        <i class="fa fa-users"></i>
                                    </div>
                                    27
                                </div>
                                <div class="stat__label">Total de Perfis</div>
                            </div>
                            <div class="stat">
                                <div class="stat__value">
                                    <div class="stat__icon stat__icon--purple">
                                        <i class="fa fa-link"></i>
                                    </div>
                                    43
                                </div>
                                <div class="stat__label">Conexões</div>
                            </div>
                            <div class="stat">
                                <div class="stat__value">
                                    <div class="stat__icon stat__icon--green">
                                        <i class="fa fa-id"></i>
                                    </div>
                                    27
                                </div>
                                <div class="stat__label">CPFs Verificados</div>
                            </div>
                            <div class="stat">
                                <div class="stat__value">
                                    <div class="stat__icon stat__icon--yellow">
                                        <i class="fa fa-calendar"></i>
                                    </div>
                                    14
                                </div>
                                <div class="stat__label">Últimos 30 dias</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card card--md">
                    <div class="card__header">
                        <div>
                            <div class="card__title">Distribuição por Idade</div>
                            <div class="card__subtitle">Baseado nas datas de nascimento</div>
                        </div>
                        <div class="card__menu" id="age-chart-menu">
                            <i class="fa fa-dots"></i>
                        </div>
                    </div>
                    <div class="card__content">
                        <div class="chart-container">
                            <canvas id="age-chart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card__header">
                        <div>
                            <div class="card__title">Atividade Recente</div>
                            <div class="card__subtitle">Últimas atualizações</div>
                        </div>
                        <div class="card__menu" id="activity-menu">
                            <i class="fa fa-dots"></i>
                        </div>
                    </div>
                    <div class="card__content">
                        <div class="activity-feed">
                            <div class="activity-item">
                                <div class="activity-item__icon" style="background:rgba(0, 243, 255, 0.1); color:var(--primary)">
                                    <i class="fa fa-user"></i>
                                </div>
                                <div class="activity-item__content">
                                    <div class="activity-item__title">Novo perfil adicionado</div>
                                    <div class="activity-item__description">Sarah Pereira Bento foi adicionada ao sistema</div>
                                    <div class="activity-item__time">Hoje, 14:35</div>
                                </div>
                            </div>
                            <div class="activity-item">
                                <div class="activity-item__icon" style="background:rgba(153, 51, 255, 0.1); color:var(--secondary)">
                                    <i class="fa fa-link"></i>
                                </div>
                                <div class="activity-item__content">
                                    <div class="activity-item__title">Conexão descoberta</div>
                                    <div class="activity-item__description">Nova conexão entre Lucas Santiago Mateini e Júlia Santiago Mateini</div>
                                    <div class="activity-item__time">Hoje, 11:23</div>
                                </div>
                            </div>
                            <div class="activity-item">
                                <div class="activity-item__icon" style="background:rgba(0, 255, 136, 0.1); color:var(--success)">
                                    <i class="fa fa-check"></i>
                                </div>
                                <div class="activity-item__content">
                                    <div class="activity-item__title">Verificação concluída</div>
                                    <div class="activity-item__description">CPF de Raphael Cittadino Andrade verificado</div>
                                    <div class="activity-item__time">Ontem, 16:42</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card card--lg">
                    <div class="card__header">
                        <div>
                            <div class="card__title">Perfis Cadastrados</div>
                            <div class="card__subtitle">Lista completa de indivíduos</div>
                        </div>
                        <div class="card__menu" id="profiles-table-menu">
                            <i class="fa fa-dots"></i>
                        </div>
                    </div>
                    <div class="card__content">
                        <div class="classroom-btns">
                            <button id="btn-1TDCPH" class="classroom-btn">Mostrar Perfis 1TDCPH</button>
                            <button id="btn-1TDCPF" class="classroom-btn">Mostrar Perfis 1TDCPF</button>
                            <button id="btn-hide" class="classroom-btn">Ocultar Perfis</button>
                        </div>
                        <div class="table-container">
                            <table class="data-table" id="profiles-table">
                                <thead>
                                    <tr>
                                        <th>Nome</th>
                                        <th>RM</th>
                                        <th>Nascimento</th>
                                        <th>CPF</th>
                                        <th>Senha</th>
                                        <th>Mãe</th>
                                        <th>Status</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <div class="card card--lg">
                    <div class="card__header">
                        <div>
                            <div class="card__title">Mapa de Conexões</div>
                            <div class="card__subtitle">Visualização de relacionamentos</div>
                        </div>
                        <div class="card__menu" id="network-menu">
                            <i class="fa fa-dots"></i>
                        </div>
                    </div>
                    <div class="card__content">
                        <div class="network-graph">
                            <canvas id="network-canvas"></canvas>
                            <div class="loading" id="network-loading">
                                <div class="loading__spinner"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal" id="profile-modal">
        <div class="modal__content">
            <div class="modal__close" id="profile-modal-close">
                <i class="fa fa-close"></i>
            </div>
            <div class="modal__header">
                <h2 class="modal__title">Detalhes do Perfil</h2>
                <div class="modal__subtitle">Informações completas</div>
            </div>
            <div class="modal__body">
                <div class="profile-details">
                    <div class="profile-sidebar">
                        <div class="profile-image" id="profile-image">A</div>
                        <div class="profile-summary">
                            <div class="profile-summary__item">
                                <div class="profile-summary__label">Nome</div>
                                <div class="profile-summary__value" id="profile-name">Aquiles Fonseca de Almeida</div>
                            </div>
                            <div class="profile-summary__item">
                                <div class="profile-summary__label">RM</div>
                                <div class="profile-summary__value" id="profile-rm">564289</div>
                            </div>
                            <div class="profile-summary__item">
                                <div class="profile-summary__label">Nascimento</div>
                                <div class="profile-summary__value" id="profile-birth">07/11/2005</div>
                            </div>
                            <div class="profile-summary__item">
                                <div class="profile-summary__label">CPF</div>
                                <div class="profile-summary__value" id="profile-cpf">403.965.388-27</div>
                            </div>
                            <div class="profile-summary__item">
                                <div class="profile-summary__label">Senha</div>
                                <div class="profile-summary__value" id="profile-password"></div>
                            </div>
                            <div class="profile-summary__item">
                                <div class="profile-summary__label">Mãe</div>
                                <div class="profile-summary__value" id="profile-mother">Patricia Fonseca de Almeida</div>
                            </div>
                            <div class="profile-summary__item">
                                <div class="profile-summary__label">Status</div>
                                <div class="profile-summary__value" id="profile-status">
                                    <span class="data-table__status data-table__status--active">Verificado</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="profile-main">
                        <div class="tab-container">
                            <div class="tabs">
                                <div class="tab active" data-tab="connections">Conexões</div>
                                <div class="tab" data-tab="timeline">Histórico</div>
                                <div class="tab" data-tab="documents">Documentos</div>
                                <div class="tab" data-tab="locations">Localizações</div>
                            </div>
                            <div class="tab-content active" id="connections-tab">
                                <div class="connection-map">
                                    <canvas id="connection-canvas"></canvas>
                                </div>
                                <div style="margin-top: 15px">
                                    <div class="badges">
                                        <div class="badge badge--blue">Família</div>
                                        <div class="badge badge--purple">Escola</div>
                                        <div class="badge badge--green">Amigos</div>
                                    </div>
                                </div>
                                <div style="margin-top: 15px">
                                    <h3 style="margin-bottom: 12px; font-size: 16px; font-weight: 600;">Conexões Diretas</h3>
                                    <div class="table-container">
                                        <table class="data-table">
                                            <thead>
                                                <tr>
                                                    <th>Nome</th>
                                                    <th>Tipo</th>
                                                    <th>Confiabilidade</th>
                                                    <th>Última Verificação</th>
                                                </tr>
                                            </thead>
                                            <tbody id="connections-table">
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-content" id="timeline-tab">
                                <div class="timeline">
                                    <div class="timeline-item">
                                        <div class="timeline-item__date">03/06/2025</div>
                                        <div class="timeline-item__title">Perfil atualizado</div>
                                        <div class="timeline-item__description">Informações de contato atualizadas</div>
                                    </div>
                                    <div class="timeline-item">
                                        <div class="timeline-item__date">15/05/2025</div>
                                        <div class="timeline-item__title">Conexão descoberta</div>
                                        <div class="timeline-item__description">Nova conexão com Gabriel Pereira Catini</div>
                                    </div>
                                    <div class="timeline-item">
                                        <div class="timeline-item__date">10/05/2025</div>
                                        <div class="timeline-item__title">Perfil criado</div>
                                        <div class="timeline-item__description">Perfil adicionado ao sistema</div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-content" id="documents-tab">
                                <div style="text-align: center; padding: 30px 0; color: rgba(255,255,255,0.5);">
                                    Nenhum documento disponível para este perfil.
                                </div>
                            </div>
                            <div class="tab-content" id="locations-tab">
                                <div style="text-align: center; padding: 30px 0; color: rgba(255,255,255,0.5);">
                                    Nenhuma localização registrada para este perfil.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal" id="settings-modal">
        <div class="modal__content">
            <div class="modal__close" id="settings-modal-close">
                <i class="fa fa-close"></i>
            </div>
            <div class="modal__header">
                <h2 class="modal__title">Configurações do Sistema</h2>
                <div class="modal__subtitle">Personalize o MK-OSINT</div>
            </div>
            <div class="modal__body">
                <div class="settings-section">
                    <h3 class="settings-section__title">Configurações Gerais</h3>
                    <div class="settings-group">
                        <div class="settings-item">
                            <div>
                                <div class="settings-item__label">Modo Escuro</div>
                                <div class="settings-item__description">Alternar entre tema claro e escuro</div>
                            </div>
                            <label class="toggle">
                                <input type="checkbox" id="dark-mode-toggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="settings-item">
                            <div>
                            <div class="settings-item__label">Notificações</div>
                                <div class="settings-item__description">Receber alertas de sistema</div>
                            </div>
                            <label class="toggle">
                                <input type="checkbox" id="notifications-toggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="settings-item">
                            <div>
                                <div class="settings-item__label">Animações</div>
                                <div class="settings-item__description">Habilitar animações da interface</div>
                            </div>
                            <label class="toggle">
                                <input type="checkbox" id="animations-toggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3 class="settings-section__title">Segurança</h3>
                    <div class="settings-group">
                        <div class="settings-item">
                            <div>
                                <div class="settings-item__label">Nível de Segurança</div>
                                <div class="settings-item__description">Controle de acesso ao sistema</div>
                            </div>
                            <div class="settings-dropdown">
                                <select id="security-level">
                                    <option value="low">Básico</option>
                                    <option value="medium" selected>Padrão</option>
                                    <option value="high">Avançado</option>
                                </select>
                            </div>
                        </div>
                        <div class="settings-item">
                            <div>
                                <div class="settings-item__label">Bloqueio Automático</div>
                                <div class="settings-item__description">Bloquear após período de inatividade</div>
                            </div>
                            <label class="toggle">
                                <input type="checkbox" id="auto-lock-toggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="settings-item">
                            <div>
                                <div class="settings-item__label">Tempo de Bloqueio</div>
                                <div class="settings-item__description">Tempo até bloqueio automático</div>
                            </div>
                            <div class="settings-dropdown">
                                <select id="lock-timeout">
                                    <option value="5">5 minutos</option>
                                    <option value="10" selected>10 minutos</option>
                                    <option value="30">30 minutos</option>
                                    <option value="60">1 hora</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3 class="settings-section__title">OSINT</h3>
                    <div class="settings-group">
                        <div class="settings-item">
                            <div>
                                <div class="settings-item__label">Fontes de Dados</div>
                                <div class="settings-item__description">Escolha quais fontes utilizar</div>
                            </div>
                            <div class="settings-dropdown">
                                <select id="data-sources">
                                    <option value="all" selected>Todas</option>
                                    <option value="social">Redes Sociais</option>
                                    <option value="public">Registros Públicos</option>
                                    <option value="custom">Personalizado</option>
                                </select>
                            </div>
                        </div>
                        <div class="settings-item">
                            <div>
                                <div class="settings-item__label">Profundidade de Busca</div>
                                <div class="settings-item__description">Nível de profundidade das buscas</div>
                            </div>
                            <div class="settings-dropdown">
                                <select id="search-depth">
                                    <option value="basic">Básica</option>
                                    <option value="standard" selected>Padrão</option>
                                    <option value="advanced">Avançada</option>
                                    <option value="deep">Profunda</option>
                                </select>
                            </div>
                        </div>
                        <div class="settings-item">
                            <div>
                                <div class="settings-item__label">Modo Anônimo</div>
                                <div class="settings-item__description">Realizar buscas de forma anônima</div>
                            </div>
                            <label class="toggle">
                                <input type="checkbox" id="anonymous-toggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal__footer">
                <button class="btn btn--outline" id="reset-settings">Restaurar Padrão</button>
                <button class="btn btn--primary" id="save-settings">Salvar Configurações</button>
            </div>
        </div>
    </div>
    
    <div class="modal" id="database-modal">
        <div class="modal__content">
            <div class="modal__close" id="database-modal-close">
                <i class="fa fa-close"></i>
            </div>
            <div class="modal__header">
                <h2 class="modal__title">Banco de Dados</h2>
                <div class="modal__subtitle">Visualização do arquivo 1.txt</div>
            </div>
            <div class="modal__body">
                <div class="database-search-container">
                    <i class="fa fa-search database-search-icon"></i>
                    <input type="text" id="database-search-input" class="database-search-input" placeholder="Pesquisar no banco de dados..." autofocus>
                    <button id="database-search-button" class="database-search-button">Buscar</button>
                    <div id="database-search-results" class="database-search-results" style="display: none;">
                        Encontrado(s) <span id="database-search-count">0</span> resultado(s)
                    </div>
                </div>
                <pre id="database-content" class="database-content">Carregando conteúdo do banco de dados...</pre>
                
                <div class="database-pagination">
                    <div class="database-pagination-info">
                        Exibindo página <span id="current-page">1</span> de <span id="total-pages">1</span>
                        (<span id="total-records">0</span> registros)
                    </div>
                    <div class="database-pagination-controls">
                        <select id="page-size-select" class="database-pagination-select">
                            <option value="50">50 por página</option>
                            <option value="100">100 por página</option>
                            <option value="200">200 por página</option>
                            <option value="500">500 por página</option>
                        </select>
                        <button id="prev-page" class="database-pagination-btn" disabled>
                            <i class="fa fa-chevron-left"></i> Anterior
                        </button>
                        <button id="next-page" class="database-pagination-btn" disabled>
                            Próxima <i class="fa fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="modal__footer">
                <button class="btn btn--outline" id="clear-database-search">Limpar Busca</button>
                <button class="btn btn--primary" id="close-database">Fechar</button>
            </div>
        </div>
    </div>
    
    <div class="modal" id="file-search-modal">
        <div class="modal__content">
            <div class="modal__close" id="file-search-modal-close">
                <i class="fa fa-close"></i>
            </div>
            <div class="modal__header">
                <h2 class="modal__title">Busca em Arquivo</h2>
                <div class="modal__subtitle">Resultados do arquivo 1.txt</div>
            </div>
            <div class="modal__body">
                <div class="settings-section">
                    <h3 class="settings-section__title">Consulta</h3>
                    <div class="settings-group">
                        <div class="form-group" style="position: relative;">
                            <label for="file-search-query">Termo de Busca</label>
                            <input type="text" id="file-search-query" class="form-control" placeholder="Nome, CPF, Telefone ou Placa">
                            <button id="run-file-search-inner" class="database-search-button" style="top: 50%; margin-top: -5px;">Buscar</button>
                        </div>
                        <div class="form-group">
                            <label for="file-search-type">Tipo de Busca</label>
                            <select id="file-search-type" class="form-control">
                                <option value="all">Todos os Campos</option>
                                <option value="nome">Nome</option>
                                <option value="cpf">CPF/CNPJ</option>
                                <option value="telefone">Telefone</option>
                                <option value="placa">Placa</option>
                                <option value="pessoa">Apenas Pessoas</option>
                            </select>
                        </div>
                    </div>
                    </div>
                </div>
            </div>
            <div class="modal__footer">
                <button class="btn btn--outline" id="clear-file-search">Limpar</button>
                <button class="btn btn--primary" id="run-file-search">Buscar</button>
            </div>
        </div>
    </div>
    
    <div class="notification" id="notification">
        <div class="notification__icon" style="background:rgba(0, 243, 255, 0.1); color:var(--primary)">
            <i class="fa fa-info"></i>
        </div>
        <div class="notification__content">
            <div class="notification__title">Análise iniciada</div>
            <div class="notification__message">Coletando informações de fontes abertas...</div>
        </div>
        <div class="notification__close" id="notification-close">
            <i class="fa fa-close"></i>
        </div>
    </div>
    
    <div class="floating-card" id="node-info">
        <div class="floating-card__title">
            <i class="fa fa-user" style="color: var(--primary)"></i>
            <span id="node-name">Nome do Perfil</span>
        </div>
        <div class="floating-card__item">
            <div class="floating-card__label">RM</div>
            <div id="node-rm">000000</div>
        </div>
        <div class="floating-card__item">
            <div class="floating-card__label">CPF</div>
            <div id="node-cpf">000.000.000-00</div>
        </div>
        <div class="floating-card__item">
            <div class="floating-card__label">Nascimento</div>
            <div id="node-birth">00/00/0000</div>
        </div>
        <div class="floating-card__item">
            <div class="floating-card__label">Conexões</div>
            <div id="node-connections">0</div>
        </div>
    </div>
    
    <script>
let profiles = [];
let restrictedProfileNames = [];
let relationships = [];
let showClassroom = false;
let currentClassroom = "";
let isAdmin = true;
let fileDataCache = null;

let databasePages = [];
let currentPage = 1;
let pageSize = 50;
let totalPages = 1;
let isSearchMode = false;
let searchResults = null;

let lastSearchResults = [];
let isSearching = false;

let currentProfileId = null;
let ageChart = null;
let networkGraph = null;
let connectionGraph = null;

document.addEventListener('DOMContentLoaded', function() {
    const preloader = document.querySelector('.preloader');
    const preloaderBar = document.getElementById('preloader-bar');
    const preloaderText = document.querySelector('.preloader__text');
    const authStatus = document.getElementById('auth-status');
    
    createRaindrops();
    
    setTimeout(() => {
        let progress = 0;
        const interval = setInterval(() => {
            progress += Math.random() * 20;
            if (progress > 100) {
                progress = 100;
                clearInterval(interval);
                
                setTimeout(() => {
                    preloaderBar.style.width = '100%';
                    preloaderBar.style.backgroundColor = '#00ff88';
                    
                    preloader.style.opacity = '0';
                    setTimeout(() => {
                        preloader.style.display = 'none';
                        initSystem();
                    }, 300);
                }, 100);
            }
            
            preloaderBar.style.width = `${progress}%`;
        }, 100);
    }, 500);
    
    initGlobalEvents();
});

function createRaindrops() {
    const container = document.body;
    const raindropCount = Math.min(window.innerWidth / 4, 150); 
    
    const positions = [];
    for (let i = 0; i < raindropCount; i++) {
        positions.push({
            height: Math.random() * 20 + 10,
            width: Math.random() * 1.5 + 1,
            left: Math.random() * 100,
            delay: Math.random() * 5,
            duration: Math.random() * 2 + 2,
            xOffset: Math.random() * 10
        });
    }
    
    for (let i = 0; i < raindropCount; i++) {
        const raindrop = document.createElement('div');
        raindrop.className = 'raindrop';
        
        const pos = positions[i];
        
        raindrop.style.height = `${pos.height}px`;
        raindrop.style.width = `${pos.width}px`;
        raindrop.style.left = `${pos.left}vw`;
        raindrop.style.opacity = 0.6;
        raindrop.style.top = `-${pos.height}px`;
        
        raindrop.style.animation = `rainfall-${i} ${pos.duration}s linear ${pos.delay}s infinite`;
        
        const keyframes = `
            @keyframes rainfall-${i} {
                0% {
                    transform: translate3d(0, 0, 0);
                }
                85% {
                    opacity: 0.6;
                }
                100% {
                    transform: translate3d(${pos.xOffset}px, ${window.innerHeight + 100}px, 0);
                    opacity: 0;
                }
            }
        `;
        
        const style = document.createElement('style');
        style.innerHTML = keyframes;
        document.head.appendChild(style);
        
        container.appendChild(raindrop);
    }
}

function initSystem() {
    loadProfilesData()
        .then(() => {
            initDashboard();
            initFileSearchModal();
            initDatabaseModal();
            
            showNotification('Bem-vindo', 'Sistema MK-OSINT inicializado com sucesso', 'success');
        })
        .catch(error => {
            console.error("Erro ao inicializar o sistema:", error);
            showNotification('Erro', 'Não foi possível carregar os dados do sistema', 'error');
        });
}

function loadProfilesData() {
    return new Promise((resolve, reject) => {
        try {
            const profilesTDCPH = [
                {
                    id: 1,
                    name: "Aquiles Fonseca de Almeida",
                    rm: "564289",
                    birth: "07/11/2005",
                    cpf: "403.965.388-27",
                    gender: "M",
                    mother: "Patricia Fonseca de Almeida",
                    status: "active",
                    classroom: "1TDCPH",
                    password: "071105"
                },
                {
                    id: 2,
                    name: "Carlos Alberto Oliveira Nascimento",
                    rm: "565694",
                    birth: "21/10/2004",
                    cpf: "423.988.598-19",
                    gender: "M",
                    mother: "Sem informação",
                    status: "active",
                    classroom: "1TDCPH",
                    password: "211004"
                },
                {
                    id: 3,
                    name: "Cauã Massi Gallo de Oliveira",
                    rm: "564741",
                    birth: "24/11/2006",
                    cpf: "456.911.848-81",
                    gender: "M",
                    mother: "Thais Massi Gallo",
                    status: "active",
                    classroom: "1TDCPH",
                    password: "241106"
                },
                {
                    id: 4,
                    name: "Eduardo José Araujo dos Santos",
                    rm: "564584",
                    birth: "07/12/2006",
                    cpf: "471.950.038-25",
                    gender: "M",
                    mother: "Maria Araujo dos Santos",
                    status: "active",
                    classroom: "1TDCPH",
                    password: "071206"
                },
                {
                    id: 5,
                    name: "Enzo Marques Mizuguchi",
                    rm: "563302",
                    birth: "28/01/2007",
                    cpf: "492.183.588-80",
                    gender: "M",
                    mother: "Carla Marques Mizuguchi",
                    status: "active",
                    classroom: "1TDCPH",
                    password: "280107"
                },
                {
                    id: 6,
                    name: "Erick Willian Miguel",
                    rm: "564896",
                    birth: "15/02/1984",
                    cpf: "324.458.838-73",
                    gender: "M",
                    mother: "REGINA ROMANA MIGUEL",
                    status: "active",
                    classroom: "1TDCPH",
                    password: "150284"
                },
                {
                    id: 7,
                    name: "Gabriel Pereira Catini",
                    rm: "563079",
                    birth: "16/05/2005",
                    cpf: "381.674.128-22",
                    gender: "M",
                    mother: "Lurdes da Penha Pereira Catini",
                    status: "active",
                    classroom: "1TDCPH",
                    password: "160505"
                },
                {
                    id: 8,
                    name: "Guilherme Augusto Miranda",
                    rm: "565207",
                    birth: "21/10/2006",
                    cpf: "424.397.748-80",
                    gender: "M",
                    mother: "Cristiane Miranda",
                    status: "active",
                    classroom: "1TDCPH",
                    password: "211006"
                },
                {
                    id: 9,
                    name: "Guilherme Nascimento",
                    rm: "562887",
                    birth: "06/10/2004",
                    cpf: "528.857.228-35",
                    gender: "M",
                    mother: "Ana Paula Nascimento",
                    status: "active",
                    classroom: "1TDCPH",
                    password: "061004"
                },
                {
                    id: 10,
                    name: "Henrique Pereira Duarte",
                    rm: "561800",
                    birth: "27/04/2007",
                    cpf: "553.668.928-21",
                    gender: "M",
                    mother: "Simone Pereira",
                    status: "active",
                    classroom: "1TDCPH",
                    password: "270407"
                },
                {
                    id: 11,
                    name: "Jonathas de Souza dos Santos",
                    rm: "562431",
                    birth: "22/01/2007",
                    cpf: "506.426.198-59",
                    gender: "M",
                    mother: "Luciana de Souza Santos",
                    status: "active",
                    classroom: "1TDCPH",
                    password: "220107"
                },
                {
                    id: 12,
                    name: "Júlia Santiago Mateini",
                    rm: "561315",
                    birth: "29/03/2007",
                    cpf: "136.329.887-90",
                    gender: "F",
                    mother: "Priscila Soares Santiago Mateini",
                    status: "active",
                    classroom: "1TDCPH",
                    password: "290307",
                    relationships: [
                        { type: "family", to: 13, label: "Irmão" }
                    ]
                },
                {
                    id: 13,
                    name: "Lucas Santiago Mateini",
                    rm: "561315",
                    birth: "15/08/2005",
                    cpf: "136.329.887-91",
                    gender: "M",
                    mother: "Priscila Soares Santiago Mateini",
                    status: "active",
                    classroom: "1TDCPH",
                    password: "150805"
                },
                {
                    id: 14,
                    name: "Kaique Barsi Auricchio",
                    rm: "563446",
                    birth: "15/12/2006",
                    cpf: "398.246.558-32",
                    gender: "M",
                    mother: "Luciane Maria Barsi Auricchio",
                    status: "active",
                    classroom: "1TDCPH",
                    password: "151206"
                },
                {
                    id: 15,
                    name: "Leandro de Souza da Silva",
                    rm: "566485",
                    birth: "30/06/2006",
                    cpf: "534.322.858-50",
                    gender: "M",
                    mother: "Roberta Souza da Silva",
                    status: "active",
                    classroom: "1TDCPH",
                    password: "300606"
                },
                {
                    id: 16,
                    name: "Lucas Cardoso Bernardes",
                    rm: "562689",
                    birth: "08/02/2002",
                    cpf: "512.672.068-61",
                    gender: "M",
                    mother: "Márcia Cardoso",
                    status: "active",
                    classroom: "1TDCPH",
                    password: "080202"
                },
                {
                    id: 17,
                    name: "Lucas Carvalho Barbosa de Sousa",
                    rm: "563231",
                    birth: "17/12/2002",
                    cpf: "443.149.558-48",
                    gender: "M",
                    mother: "Regina Carvalho",
                    status: "active",
                    classroom: "1TDCPH",
                    password: "171202"
                },
                {
                    id: 18,
                    name: "Lucas Roggerio Imparato",
                    rm: "554896",
                    birth: "21/10/2005",
                    cpf: "525.844.258-66",
                    gender: "M",
                    mother: "Adriana Roggerio",
                    status: "active",
                    classroom: "1TDCPH",
                    password: "211005"
                },
                {
                    id: 19,
                    name: "Lucas Rossi Rodrigues",
                    rm: "564375",
                    birth: "14/12/2006",
                    cpf: "390.132.058-01",
                    gender: "M",
                    mother: "Rosane Rossi Rodrigues",
                    status: "active",
                    classroom: "1TDCPH",
                    password: "141206"
                },
                {
                    id: 20,
                    name: "Marco Antônio Barone Schoppan",
                    rm: "94729",
                    birth: "16/10/2001",
                    cpf: "497.007.068-77",
                    gender: "M",
                    mother: "Amanda Barone",
                    status: "active",
                    classroom: "1TDCPH",
                    password: "161001"
                },
                {
                    id: 21,
                    name: "MK procurado pelo FBI",
                    rm: "******",
                    birth: "**/**/****",
                    cpf: "***.***.***-**",
                    gender: "M",
                    mother: "Não informado",
                    status: "inactive",
                    classroom: "1TDCPH",
                    password: "******"
                },
                {
                    id: 22,
                    name: "Pedro Augusto Belo Ferreira",
                    rm: "565530",
                    birth: "16/09/2006",
                    cpf: "438.537.328-01",
                    gender: "M",
                    mother: "Luciana Belo",
                    status: "active",
                    classroom: "1TDCPH",
                    password: "160906"
                },
                {
                    id: 23,
                    name: "Raphael Cittadino Andrade",
                    rm: "556902",
                    birth: "13/02/2005",
                    cpf: "540.006.228-89",
                    gender: "M",
                    mother: "Márcia Cittadino",
                    status: "active",
                    classroom: "1TDCPH",
                    password: "130205"
                },
                {
                    id: 24,
                    name: "Raul Azzi Corsi",
                    rm: "565112",
                    birth: "24/07/2004",
                    cpf: "522.418.538-60",
                    gender: "M",
                    mother: "Silvia Azzi",
                    status: "active",
                    classroom: "1TDCPH",
                    password: "240704"
                },
                {
                    id: 25,
                    name: "Rayron Souza Ranieri",
                    rm: "563103",
                    birth: "27/08/2006",
                    cpf: "505.824.128-54",
                    gender: "M",
                    mother: "Fernanda Souza",
                    status: "active",
                    classroom: "1TDCPH",
                    password: "270806"
                },
                {
                    id: 26,
                    name: "Sarah Pereira Bento",
                    rm: "562333",
                    birth: "11/01/2007",
                    cpf: "402.527.748-41",
                    gender: "F",
                    mother: "Sirlene Aparecida Pereira",
                    status: "active",
                    classroom: "1TDCPH",
                    password: "110107"
                },
                {
                    id: 27,
                    name: "Vinicius Pinheiro Olivetti",
                    rm: "98255",
                    birth: "10/07/2003",
                    cpf: "446.085.878-97",
                    gender: "M",
                    mother: "Claudia Pinheiro",
                    status: "active",
                    classroom: "1TDCPH",
                    password: "100703"
                },
                {
                    id: 28,
                    name: "Yasmin Barbosa Vasconcelos",
                    rm: "561803",
                    birth: "05/07/2006",
                    cpf: "490.661.038-25",
                    gender: "F",
                    mother: "Daniela Barbosa",
                    status: "active",
                    classroom: "1TDCPH",
                    password: "050706"
                },
                {
                    id: 29,
                    name: "Vitor Yuji Suenaga Yoshida",
                    rm: "563005",
                    birth: "03/07/2006",
                    cpf: "446.079.228-11",
                    gender: "M",
                    mother: "Cintia Suenaga",
                    status: "active",
                    classroom: "1TDCPH",
                    password: "030706"
                }
            ];
            
            const profilesTDCPF = [
                {
                    id: 30,
                    name: "Ana Clara Oliveira Santos",
                    rm: "571234",
                    birth: "15/03/2006",
                    cpf: "421.365.788-54",
                    gender: "F",
                    mother: "Maria Oliveira Santos",
                    status: "active",
                    classroom: "1TDCPF",
                    password: "150306"
                },
                {
                    id: 31,
                    name: "Bruno Henrique Silva",
                    rm: "574561",
                    birth: "08/04/2005",
                    cpf: "452.178.938-12",
                    gender: "M",
                    mother: "Silvia Helena Silva",
                    status: "active",
                    classroom: "1TDCPF",
                    password: "080405"
                },
                {
                    id: 45,
                    name: "Rafael Moreira Rocha",
                    rm: "586789",
                    birth: "27/02/2005",
                    cpf: "481.596.278-61",
                    gender: "M",
                    mother: "Adriana Moreira",
                    status: "active",
                    classroom: "1TDCPF",
                    password: "270205"
                }
            ];
            
            profiles = [...profilesTDCPH, ...profilesTDCPF];
            
            initializeRelationships();
            
            resolve();
        } catch (error) {
            console.error("Erro ao carregar dados dos perfis:", error);
            reject(error);
        }
    });
}

function initializeRelationships() {
    relationships = [
        { source: 1, target: 7, type: "school" },
        { source: 1, target: 19, type: "friend" },
        { source: 2, target: 9, type: "family" },
        { source: 3, target: 5, type: "school" },
        { source: 3, target: 11, type: "friend" },
        { source: 4, target: 15, type: "school" },
        { source: 5, target: 10, type: "friend" },
        { source: 7, target: 18, type: "school" },
        { source: 8, target: 22, type: "friend" },
        { source: 9, target: 2, type: "family" },
        { source: 12, target: 13, type: "family" },
        { source: 14, target: 19, type: "school" },
        { source: 16, target: 20, type: "friend" },
        { source: 17, target: 27, type: "school" },
        { source: 19, target: 25, type: "friend" },
        { source: 23, target: 28, type: "school" },
        { source: 24, target: 27, type: "friend" },
        { source: 26, target: 12, type: "school" },
        { source: 30, target: 31, type: "friend" },
        { source: 7, target: 36, type: "family" },
        { source: 12, target: 34, type: "friend" },
        { source: 19, target: 41, type: "school" }
    ];
}

function calculateAge(birthDateStr) {
    if (!birthDateStr || birthDateStr === "Não informado") return null;
    
    const parts = birthDateStr.split('/');
    const birthDate = new Date(parts[2], parts[1] - 1, parts[0]);
    const today = new Date();
    
    let age = today.getFullYear() - birthDate.getFullYear();
    const monthDiff = today.getMonth() - birthDate.getMonth();
    
    if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
        age--;
    }
    
    return age;
}

let activeFilters = {
    status: 'all',
    gender: 'all',
    age: 'all',
    search: '',
    classroom: 'all'
};

function loadDataFile() {
    fetch('1.txt')
        .then(response => {
            if (!response.ok) {
                throw new Error('Arquivo 1.txt não encontrado');
            }
            return response.text();
        })
        .then(data => {
            fileDataCache = data;
            console.log('Arquivo 1.txt carregado com sucesso');
            
            prepareDataForPagination(data);
        })
        .catch(error => {
            console.error('Erro ao carregar arquivo:', error);
            showNotification('Arquivo', 'Não foi possível carregar o arquivo 1.txt', 'warning');
        });
}

function prepareDataForPagination(data) {
    const blockPattern = /(?:=+\s*CONSULTA|\🔍\s*CONSULTA|👤\s*DADOS PESSOAIS)/i;
    
    const records = data.split(blockPattern)
        .filter(block => block && block.trim())
        .map(block => blockPattern.source.charAt(0) + block);
    
    totalPages = Math.ceil(records.length / pageSize);
    
    const processedRecords = records.map(record => {
        return record.trim();
    });
    
    databasePages = [];
    for (let i = 0; i < totalPages; i++) {
        const startIdx = i * pageSize;
        const endIdx = Math.min(startIdx + pageSize, processedRecords.length);
        const pageRecords = processedRecords.slice(startIdx, endIdx);
        databasePages.push(pageRecords.join('\n\n'));
    }
    
    document.getElementById('total-pages').textContent = totalPages;
    document.getElementById('total-records').textContent = records.length;
}

function displayCurrentPage() {
    const databaseContent = document.getElementById('database-content');
    const loading = document.createElement('div');
    loading.className = 'database-loading';
    loading.innerHTML = '<div class="loading__spinner"></div> Carregando dados...';
    databaseContent.innerHTML = '';
    databaseContent.appendChild(loading);
    
    setTimeout(() => {
        if (isSearchMode && searchResults) {
            const startIdx = (currentPage - 1) * pageSize;
            const endIdx = Math.min(startIdx + pageSize, searchResults.length);
            const pageRecords = searchResults.slice(startIdx, endIdx);
            
            const formattedRecords = pageRecords.map(record => {
                const query = document.getElementById('database-search-input').value;
                
                if (query) {
                    const highlightedRecord = record.replace(new RegExp(query, 'gi'), match => 
                        `<span class="highlight">${match}</span>`
                    );
                    return `<div class="search-result-record">${highlightedRecord}</div>`;
                } else {
                    return `<div class="search-result-record">${record}</div>`;
                }
            });
            
            databaseContent.innerHTML = formattedRecords.join('');
            
            if (!document.getElementById('search-result-style')) {
                const style = document.createElement('style');
                style.id = 'search-result-style';
                style.textContent = `
                    .search-result-record {
                        margin-bottom: 20px;
                        padding: 15px;
                        background: rgba(10, 14, 23, 0.7);
                        border-left: 3px solid var(--primary);
                        border-radius: 8px;
                        white-space: pre-wrap;
                        font-family: monospace;
                        line-height: 1.5;
                    }
                    .highlight {
                        background-color: rgba(255, 204, 0, 0.3);
                        color: white;
                        padding: 0 2px;
                        border-radius: 3px;
                        font-weight: bold;
                    }
                `;
                document.head.appendChild(style);
            }
            
            document.getElementById('current-page').textContent = currentPage;
            document.getElementById('total-pages').textContent = Math.ceil(searchResults.length / pageSize);
            document.getElementById('total-records').textContent = searchResults.length;
        } else if (databasePages && databasePages[currentPage - 1]) {
            databaseContent.textContent = databasePages[currentPage - 1];
            
            document.getElementById('current-page').textContent = currentPage;
        } else {
            databaseContent.textContent = 'Nenhum dado disponível para exibição.';
        }
        
        updatePaginationControls();
    }, 5);
}

function updatePaginationControls() {
    const prevPageBtn = document.getElementById('prev-page');
    const nextPageBtn = document.getElementById('next-page');
    
    prevPageBtn.disabled = currentPage <= 1;
    nextPageBtn.disabled = currentPage >= totalPages;
}

function normalizeText(text) {
    if (!text) return '';
    
    const normalized = text.toLowerCase()
        .replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g, '')
        .replace(/\s+/g, ' ');
    
    return normalized.normalize('NFD').replace(/[\u0300-\u036f]/g, '');
}

function escapeRegExp(string) {
    return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
}

function searchInFile(query, searchType = 'all') {
    if (query && query.length > 3) {
        showNotification('Buscando...', 'Analisando registros do arquivo', 'info');
    }
    
    return new Promise((resolve) => {
        setTimeout(() => {
            if (!query || !fileDataCache) {
                resolve([]);
                return;
            }
            
            const normalizedQuery = normalizeText(query);
            
            const blockPattern = /(?:=+\s*CONSULTA|\🔍\s*CONSULTA|👤\s*DADOS PESSOAIS|NOME\s*:|CPF\s*:|PESSOA\s*:)/i;
            
            const blocks = fileDataCache.split(blockPattern)
                .filter(block => block && block.trim());
            
            const records = [];
            for (let i = 0; i < blocks.length; i++) {
                let fullBlock = blocks[i];
                const matches = fileDataCache.match(new RegExp(`(${blockPattern.source})${escapeRegExp(blocks[i].substring(0, 50))}`, 'i'));
                
                if (matches && matches[1]) {
                    fullBlock = matches[1] + fullBlock;
                } else {
                    fullBlock = "CONSULTA " + fullBlock;
                }
                
                const endMatch = fullBlock.match(/\n\s*\n\s*\n/);
                if (endMatch) {
                    fullBlock = fullBlock.substring(0, endMatch.index + endMatch[0].length);
                }
                
                records.push(fullBlock);
            }
            
            const recordIndex = new Map();
            records.forEach((record, idx) => {
                const normalizedRecord = normalizeText(record);
                searchParts.forEach(part => {
                    if (normalizedRecord.includes(part)) {
                        if (!recordIndex.has(idx)) {
                            recordIndex.set(idx, 1);
                        } else {
                            recordIndex.set(idx, recordIndex.get(idx) + 1);
                        }
                    }
                });
            });
            
            const matchedRecords = [];
            const searchParts = normalizedQuery.split(' ').filter(part => part.length > 2);
            
            recordIndex.forEach((count, idx) => {
                if (count > 0) {
                    const record = records[idx];
                    const normalizedRecord = normalizeText(record);
                    
                    const isPerson = /nome|cpf|nascimento|dados pessoais/i.test(normalizedRecord);
                    
                    if (searchType === 'pessoa' && !isPerson) {
                        return;
                    }
                    
                    if (searchType === 'nome' && !record.match(/NOME\s*:/i)) {
                        return;
                    }
                    if (searchType === 'cpf' && !record.match(/CPF\s*:|CPF\/CNPJ\s*:/i)) {
                        return;
                    }
                    if (searchType === 'telefone' && !record.match(/TELEFONE\s*:/i)) {
                        return;
                    }
                    if (searchType === 'placa' && !record.match(/PLACA\s*:/i)) {
                        return;
                    }
                    
                    matchedRecords.push(record);
                }
            });
            
            const processedResults = matchedRecords.map(record => {
                const nameMatch = record.match(/NOME\s*:\s*([^\n]+)/i);
                const cpfMatch = record.match(/CPF\s*:|CPF\/CNPJ\s*:\s*([^\n]+)/i);
                const birthMatch = record.match(/NASCIMENTO\s*:\s*([^\n]+)/i);
                const genderMatch = record.match(/SEXO\s*:\s*([^\n]+)/i);
                const motherMatch = record.match(/MÃE\s*:\s*([^\n]+)/i);
                const phoneMatch = record.match(/TELEFONE\s*:\s*([^\n]+)/i);
                const plateMatch = record.match(/PLACA\s*:\s*([^\n]+)/i);
                
                return {
                    name: nameMatch ? nameMatch[1].trim() : "Não informado",
                    cpf: cpfMatch ? cpfMatch[1].trim() : "Não informado",
                    birth: birthMatch ? birthMatch[1].trim() : "Não informado",
                    gender: genderMatch ? genderMatch[1].trim() : "Não informado",
                    mother: motherMatch ? motherMatch[1].trim() : "Não informado",
                    phone: phoneMatch ? phoneMatch[1].trim() : "Não informado",
                    plate: plateMatch ? plateMatch[1].trim() : "Não informado",
                    fullRecord: record
                };
            });
            
            const uniqueResults = [];
            const uniqueCPFs = new Set();
            
            processedResults.forEach(result => {
                if (result.cpf === "Não informado" || !uniqueCPFs.has(result.cpf)) {
                    if (result.cpf !== "Não informado") {
                        uniqueCPFs.add(result.cpf);
                    }
                    uniqueResults.push(result);
                }
            });
            
            resolve(uniqueResults);
        }, 5);
    });
}

function searchInDatabase(query) {
    const databaseContent = document.getElementById('database-content');
    const searchResultsElement = document.getElementById('database-search-results');
    const searchCount = document.getElementById('database-search-count');
    
    if (!query || !fileDataCache) {
        isSearchMode = false;
        currentPage = 1;
        displayCurrentPage();
        searchResultsElement.style.display = 'none';
        return 0;
    }
    
    const normalizedQuery = query.toLowerCase();
    
    const blockPattern = /(?:=+\s*CONSULTA|\🔍\s*CONSULTA|👤\s*DADOS PESSOAIS)/i;
    
    const records = fileDataCache.split(blockPattern)
        .filter(block => block && block.trim())
        .map(block => blockPattern.source.charAt(0) + block);
    
    const matchedRecords = [];
    const searchTerms = normalizedQuery.split(/\s+/).filter(term => term.length > 2);
    
    records.forEach(record => {
        const normalizedRecord = record.toLowerCase();
        let match = false;
        
        if (searchTerms.length > 0) {
            match = searchTerms.some(term => normalizedRecord.includes(term));
        } else {
            match = normalizedRecord.includes(normalizedQuery);
        }
        
        if (match) {
            matchedRecords.push(record);
        }
    });
    
    searchResultsElement.style.display = matchedRecords.length > 0 ? 'block' : 'none';
    searchCount.textContent = matchedRecords.length;
    
    if (matchedRecords.length > 0) {
        isSearchMode = true;
        searchResults = matchedRecords;
        currentPage = 1;
        totalPages = Math.ceil(matchedRecords.length / pageSize);
        
        const startIdx = 0;
        const endIdx = Math.min(pageSize, matchedRecords.length);
        const pageRecords = matchedRecords.slice(startIdx, endIdx);
        
        const fragment = document.createDocumentFragment();
        const style = document.createElement('style');
        
        pageRecords.forEach(record => {
            const highlightedRecord = record.replace(new RegExp(query, 'gi'), match => 
                `<span class="highlight">${match}</span>`
            );
            
            const div = document.createElement('div');
            div.className = 'search-result-record';
            div.innerHTML = highlightedRecord;
            fragment.appendChild(div);
        });
        
        databaseContent.innerHTML = '';
        databaseContent.appendChild(fragment);
        
        style.textContent = `
            .search-result-record {
                margin-bottom: 20px;
                padding: 15px;
                background: rgba(10, 14, 23, 0.7);
                border-left: 3px solid var(--primary);
                border-radius: 8px;
                white-space: pre-wrap;
                font-family: monospace;
                line-height: 1.5;
            }
            .highlight {
                background-color: rgba(255, 204, 0, 0.3);
                color: white;
                padding: 0 2px;
                border-radius: 3px;
                font-weight: bold;
            }
        `;
        
        const existingStyle = document.getElementById('search-result-style');
        if (existingStyle) {
            existingStyle.remove();
        }
        
        style.id = 'search-result-style';
        document.head.appendChild(style);
        
        document.getElementById('current-page').textContent = currentPage;
        document.getElementById('total-pages').textContent = totalPages;
        document.getElementById('total-records').textContent = matchedRecords.length;
        
        updatePaginationControls();
        
        const firstHighlight = databaseContent.querySelector('.highlight');
        if (firstHighlight) {
            firstHighlight.scrollIntoView({ behavior: 'auto', block: 'center' });
        }
    } else {
        databaseContent.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--danger);">Nenhum resultado encontrado para: ' + query + '</div>';
    }
    
    return matchedRecords.length;
}

function formatRecordForDisplay(record) {
    const formatted = record
        .replace(/🔍/g, '🔍')
        .replace(/👤/g, '👤')
        .replace(/•/g, '•')
        .replace(/\n/g, '<br>')
        .replace(/(NOME|CPF|NASCIMENTO|SEXO|MÃE|TELEFONE|ENDEREÇO|EMPRESAS|POSSÍVEIS PARENTES):/g, 
                 '<span style="color: var(--primary); font-weight: bold;">$1:</span>');
    
    return formatted;
}

function displaySearchResults(results, container) {
    if (results.length === 0) {
        container.innerHTML = '<div style="text-align: center; padding: 15px; color: var(--danger);">Nenhum resultado encontrado para a busca.</div>';
        return;
    }
    
    const fragment = document.createDocumentFragment();
    
    results.forEach(result => {
        const formattedRecord = formatRecordForDisplay(result.fullRecord);
        
        const resultItem = document.createElement('div');
        resultItem.className = 'search-result-item';
        resultItem.innerHTML = `
            <div class="search-result-header">${result.name}</div>
            <div style="margin: 5px 0;"><span style="font-weight: bold; color: var(--primary);">CPF/CNPJ:</span> <span>${result.cpf}</span></div>
            <div style="margin: 5px 0;"><span style="font-weight: bold;">Nascimento:</span> <span>${result.birth}</span></div>
            <div style="margin: 5px 0;"><span style="font-weight: bold;">Sexo:</span> <span>${result.gender}</span></div>
            <div style="margin: 5px 0;"><span style="font-weight: bold;">Mãe:</span> <span>${result.mother}</span></div>
            ${result.phone !== "Não informado" ? `<div style="margin: 5px 0;"><span style="font-weight: bold; color: var(--primary);">Telefone:</span> <span>${result.phone}</span></div>` : ''}
            ${result.plate !== "Não informado" ? `<div style="margin: 5px 0;"><span style="font-weight: bold; color: var(--primary);">Placa:</span> <span>${result.plate}</span></div>` : ''}
            
            <div style="margin-top: 10px;">
                <button class="btn btn--outline btn-view-full-record" data-record="${encodeURIComponent(result.fullRecord)}">Ver Registro Completo</button>
                <button class="btn btn--outline btn-add-profile" data-record="${encodeURIComponent(result.fullRecord)}">Adicionar ao Sistema</button>
            </div>
            
            <div class="full-record-container" style="display: none; margin-top: 15px; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 8px; white-space: pre-wrap; font-family: monospace; max-height: 300px; overflow-y: auto;">
                ${formattedRecord}
            </div>
        `;
        
        fragment.appendChild(resultItem);
    });
    
    container.innerHTML = '';
    container.appendChild(fragment);
    
    document.querySelectorAll('.btn-add-profile').forEach(button => {
        button.addEventListener('click', function() {
            const recordData = decodeURIComponent(this.getAttribute('data-record'));
            addProfileFromRecord(recordData);
        });
    });
    
    document.querySelectorAll('.btn-view-full-record').forEach(button => {
        button.addEventListener('click', function() {
            const container = this.closest('.search-result-item').querySelector('.full-record-container');
            if (container.style.display === 'none') {
                container.style.display = 'block';
                this.textContent = 'Ocultar Registro Completo';
            } else {
                container.style.display = 'none';
                this.textContent = 'Ver Registro Completo';
            }
        });
    });
}

function addProfileFromRecord(record) {
    const nameMatch = record.match(/NOME\s*:\s*([^\n]+)/i);
    const cpfMatch = record.match(/CPF\s*:|CPF\/CNPJ\s*:\s*([^\n]+)/i);
    const birthMatch = record.match(/NASCIMENTO\s*:\s*([^\n]+)/i);
    const genderMatch = record.match(/SEXO\s*:\s*([^\n]+)/i);
    const motherMatch = record.match(/MÃE\s*:\s*([^\n]+)/i);
    
    if (nameMatch) {
        const name = nameMatch[1].trim();
        const cpf = cpfMatch ? cpfMatch[1].trim() : "Não informado";
        
        const existingProfile = profiles.find(p => 
            (p.cpf === cpf && cpf !== "Não informado") || 
            (p.name.toLowerCase() === name.toLowerCase() && p.cpf === cpf)
        );
        
        if (existingProfile) {
            showNotification('Perfil Existente', `${name} já existe no sistema`, 'warning');
            return;
        }
        
        const newId = profiles.length + 1;
        const newProfile = {
            id: newId,
            name: name,
            rm: `FILE${newId}`,
            birth: birthMatch ? birthMatch[1].trim() : "Não informado",
            cpf: cpf,
            gender: genderMatch ? genderMatch[1].trim().charAt(0) : "M",
            mother: motherMatch ? motherMatch[1].trim() : "Não informado",
            status: "active",
            classroom: "ARQUIVO",
            password: "*****"
        };
        
        profiles.push(newProfile);
        
        const randomConnections = Math.floor(Math.random() * 3) + 1;
        const types = ['school', 'friend', 'family'];
        
        for (let i = 0; i < randomConnections; i++) {
            const targetId = Math.floor(Math.random() * 15) + 1;
            const randomType = types[Math.floor(Math.random() * types.length)];
            
            relationships.push({
                source: newId,
                target: targetId,
                type: randomType
            });
        }
        
        showNotification('Perfil Adicionado', `${name} foi adicionado ao sistema`, 'success');
        
        if (showClassroom) {
            applyFilters();
        }
        
        initNetworkGraph();
    }
}

function openFileSearchModal(query, results) {
    const fileSearchModal = document.getElementById('file-search-modal');
    const fileSearchQuery = document.getElementById('file-search-query');
    const fileSearchResults = document.getElementById('file-search-results');
    const fileSearchResultsContainer = document.getElementById('file-search-results-container');
    
    fileSearchQuery.value = query;
    displaySearchResults(results, fileSearchResults);
    fileSearchResultsContainer.style.display = 'block';
    fileSearchModal.classList.add('active');
}

function showDatabaseContent() {
    const databaseModal = document.getElementById('database-modal');
    const databaseContent = document.getElementById('database-content');
    
    databaseModal.classList.add('active');
    
    if (!fileDataCache) {
        databaseContent.textContent = "Erro ao carregar o arquivo 1.txt. Por favor, tente novamente.";
        return;
    }
    
    isSearchMode = false;
    currentPage = 1;
    
    displayCurrentPage();
    
    setTimeout(() => {
        document.getElementById('database-search-input').focus();
    }, 100);
}

function initGlobalEvents() {
    const notification = document.getElementById('notification');
    const notificationClose = document.getElementById('notification-close');
    
    notificationClose.addEventListener('click', function() {
        notification.classList.remove('active');
    });
    
    const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
    const sidebar = document.getElementById('sidebar');
    const sidebarOverlay = document.getElementById('sidebar-overlay');
    
    mobileMenuToggle.addEventListener('click', function() {
        this.classList.toggle('active');
        sidebar.classList.toggle('active');
        sidebarOverlay.classList.toggle('active');
    });
    
    sidebarOverlay.addEventListener('click', function() {
        sidebar.classList.remove('active');
        sidebarOverlay.classList.remove('active');
        mobileMenuToggle.classList.remove('active');
    });
    
    const settingsBtn = document.getElementById('settings-btn');
    const settingsModal = document.getElementById('settings-modal');
    const settingsModalClose = document.getElementById('settings-modal-close');
    const saveSettingsBtn = document.getElementById('save-settings');
    const resetSettingsBtn = document.getElementById('reset-settings');
    
    settingsBtn.addEventListener('click', function() {
        settingsModal.classList.add('active');
    });
    
    settingsModalClose.addEventListener('click', function() {
        settingsModal.classList.remove('active');
    });
    
    saveSettingsBtn.addEventListener('click', function() {
        settingsModal.classList.remove('active');
        showNotification('Configurações salvas', 'Suas preferências foram atualizadas com sucesso', 'success');
    });
    
    resetSettingsBtn.addEventListener('click', function() {
        document.getElementById('dark-mode-toggle').checked = true;
        document.getElementById('notifications-toggle').checked = true;
        document.getElementById('animations-toggle').checked = true;
        document.getElementById('auto-lock-toggle').checked = true;
        
        document.getElementById('security-level').value = 'medium';
        document.getElementById('lock-timeout').value = '10';
        document.getElementById('data-sources').value = 'all';
        document.getElementById('search-depth').value = 'standard';
        document.getElementById('anonymous-toggle').checked = true;
        
        showNotification('Configurações restauradas', 'As configurações padrão foram restauradas', 'info');
    });
    
    const navItems = document.querySelectorAll('.nav__item[data-section]');
    const menuItems = document.querySelectorAll('.menu__item[data-section]');
    
    function navigateTo(section) {
        navItems.forEach(item => {
            if (item.getAttribute('data-section') === section) {
                item.classList.add('active');
            } else {
                item.classList.remove('active');
            }
        });
        
        menuItems.forEach(item => {
            if (item.getAttribute('data-section') === section) {
                item.classList.add('active');
            } else {
                item.classList.remove('active');
            }
        });
        
        const pageTitle = document.querySelector('.page-title');
        const pageSubtitle = document.querySelector('.page-subtitle');
        
        switch (section) {
            case 'dashboard':
                pageTitle.textContent = 'Dashboard';
                pageSubtitle.textContent = 'Visão geral da base de dados';
                break;
            case 'profiles':
                pageTitle.textContent = 'Perfis';
                pageSubtitle.textContent = 'Gerenciamento de perfis cadastrados';
                break;
            case 'classrooms':
                pageTitle.textContent = 'Salas';
                pageSubtitle.textContent = 'Gerenciamento de salas e turmas';
                showClassroom = true;
                currentClassroom = "1TDCPH";
                setTimeout(() => {
                    applyFilters();
                }, 5);
                break;
            case 'connections':
                pageTitle.textContent = 'Conexões';
                pageSubtitle.textContent = 'Visualização de relacionamentos';
                break;
            case 'geolocation':
                pageTitle.textContent = 'Geolocalização';
                pageSubtitle.textContent = 'Mapeamento de localizações';
                break;
            case 'documents':
                pageTitle.textContent = 'Documentos';
                pageSubtitle.textContent = 'Arquivos e documentos digitais';
                break;
            case 'analysis':
                pageTitle.textContent = 'Análise';
                pageSubtitle.textContent = 'Análise de dados e informações';
                break;
            case 'reports':
                pageTitle.textContent = 'Relatórios';
                pageSubtitle.textContent = 'Geração de relatórios';
                break;
        }
        
        showNotification('Navegação', `Acessando ${pageTitle.textContent}`, 'info');
        
        if (window.innerWidth < 992) {
            sidebar.classList.remove('active');
            sidebarOverlay.classList.remove('active');
            mobileMenuToggle.classList.remove('active');
        }
    }
    
    navItems.forEach(item => {
        item.addEventListener('click', function() {
            navigateTo(this.getAttribute('data-section'));
        });
    });
    
    menuItems.forEach(item => {
        item.addEventListener('click', function() {
            navigateTo(this.getAttribute('data-section'));
        });
    });
    
    const notificationsBtn = document.getElementById('notifications-btn');
    
    notificationsBtn.addEventListener('click', function() {
        showNotification('Notificações', 'Você não tem novas notificações', 'info');
    });
    
    const userMenu = document.getElementById('user-menu');
    
    userMenu.addEventListener('click', function() {
        showNotification('Perfil do Usuário', 'Configurações de conta do administrador', 'info');
    });
}

function initFileSearchModal() {
    const fileSearchModal = document.getElementById('file-search-modal');
    const fileSearchModalClose = document.getElementById('file-search-modal-close');
    const clearFileSearchBtn = document.getElementById('clear-file-search');
    const runFileSearchBtn = document.getElementById('run-file-search');
    const runFileSearchInnerBtn = document.getElementById('run-file-search-inner');
    const fileSearchQuery = document.getElementById('file-search-query');
    const fileSearchResults = document.getElementById('file-search-results');
    const fileSearchResultsContainer = document.getElementById('file-search-results-container');
    const fileSearchType = document.getElementById('file-search-type');
    
    fileSearchModalClose.addEventListener('click', function() {
        fileSearchModal.classList.remove('active');
    });
    
    clearFileSearchBtn.addEventListener('click', function() {
        fileSearchQuery.value = '';
        fileSearchResults.innerHTML = '';
        fileSearchResultsContainer.style.display = 'none';
        fileSearchType.value = 'all';
    });
    
    runFileSearchBtn.addEventListener('click', function() {
        executeFileSearch();
    });
    
    runFileSearchInnerBtn.addEventListener('click', function() {
        executeFileSearch();
    });
    
    fileSearchQuery.addEventListener('keyup', function(e) {
        if (e.key === 'Enter') {
            executeFileSearch();
        }
    });
    
    function executeFileSearch() {
        const query = fileSearchQuery.value.trim();
        const searchType = fileSearchType.value;
        
        if (!query) {
            showNotification('Erro', 'Digite um termo para busca', 'warning');
            return;
        }
        
        if (!fileDataCache) {
            showNotification('Erro', 'Arquivo 1.txt não carregado', 'error');
            return;
        }
        
        fileSearchResults.innerHTML = '<div style="text-align: center; padding: 20px;"><div class="loading__spinner" style="display: inline-block; margin-right: 10px;"></div> Buscando...</div>';
        fileSearchResultsContainer.style.display = 'block';
        
        searchInFile(query, searchType).then(results => {
            displaySearchResults(results, fileSearchResults);
            
            if (results.length > 0) {
                showNotification('Busca Concluída', `${results.length} resultado(s) encontrado(s)`, 'success');
            } else {
                showNotification('Busca Concluída', 'Nenhum resultado encontrado', 'warning');
            }
        });
    }
}

function initDatabaseModal() {
    const databaseBtn = document.getElementById('database-btn');
    const databaseModal = document.getElementById('database-modal');
    const databaseModalClose = document.getElementById('database-modal-close');
    const databaseSearchInput = document.getElementById('database-search-input');
    const databaseSearchButton = document.getElementById('database-search-button');
    const clearDatabaseSearchBtn = document.getElementById('clear-database-search');
    const closeDatabaseBtn = document.getElementById('close-database');
    const prevPageBtn = document.getElementById('prev-page');
    const nextPageBtn = document.getElementById('next-page');
    const pageSizeSelect = document.getElementById('page-size-select');
    
    databaseBtn.addEventListener('click', function() {
        showDatabaseContent();
    });
    
    databaseModalClose.addEventListener('click', function() {
        databaseModal.classList.remove('active');
    });
    
    closeDatabaseBtn.addEventListener('click', function() {
        databaseModal.classList.remove('active');
    });
    
    databaseSearchButton.addEventListener('click', function() {
        const query = databaseSearchInput.value.trim();
        searchInDatabase(query);
    });
    
    clearDatabaseSearchBtn.addEventListener('click', function() {
        databaseSearchInput.value = '';
        isSearchMode = false;
        currentPage = 1;
        displayCurrentPage();
        document.getElementById('database-search-results').style.display = 'none';
        databaseSearchInput.focus();
    });
    
    prevPageBtn.addEventListener('click', function() {
        if (currentPage > 1) {
            currentPage--;
            displayCurrentPage();
        }
    });
    
    nextPageBtn.addEventListener('click', function() {
        if (currentPage < totalPages) {
            currentPage++;
            displayCurrentPage();
        }
    });
    
    pageSizeSelect.addEventListener('change', function() {
        pageSize = parseInt(this.value);
        
        if (fileDataCache) {
            prepareDataForPagination(fileDataCache);
            currentPage = 1;
            displayCurrentPage();
        }
    });
    
    databaseSearchInput.addEventListener('keyup', function(e) {
        if (e.key === 'Enter') {
            const query = this.value.trim();
            searchInDatabase(query);
        }
    });
}

function initDashboard() {
    populateProfilesTable([]); 
    
    initCharts();
    
    initNetworkGraph();
    
    initProfileModal();
    
    initClassroomButtons();
    
    if (window.innerWidth <= 768) {
        showNotification('Bem-vindo', 'Sistema MK-OSINT inicializado com sucesso', 'success');
    }
    
    checkOrientation();
    window.addEventListener('resize', checkOrientation);
    
    window.addEventListener('resize', function() {
        if (ageChart) {
            ageChart.resize();
        }
        
        const networkCanvas = document.getElementById('network-canvas');
        if (networkCanvas) {
            const container = networkCanvas.parentElement;
            networkCanvas.width = container.offsetWidth;
            networkCanvas.height = container.offsetHeight;
        }
        
        const connectionCanvas = document.getElementById('connection-canvas');
        if (connectionCanvas) {
            const container = connectionCanvas.parentElement;
            connectionCanvas.width = container.offsetWidth;
            connectionCanvas.height = container.offsetHeight;
        }
    });
    
    loadDataFile();
}

function checkOrientation() {
    if (window.innerWidth < window.innerHeight && window.innerWidth < 768) {
        showNotification('Dica de uso', 'Gire o dispositivo para melhor visualização', 'info');
    }
}

function initClassroomButtons() {
    const btn1TDCPH = document.getElementById('btn-1TDCPH');
    const btn1TDCPF = document.getElementById('btn-1TDCPF');
    const btnHide = document.getElementById('btn-hide');
    
    btn1TDCPH.addEventListener('click', function() {
        showClassroom = true;
        currentClassroom = "1TDCPH";
        const classroomProfiles = profiles.filter(p => p.classroom === currentClassroom);
        
        window.requestAnimationFrame(() => {
            populateProfilesTable(classroomProfiles);
            
            document.getElementById('total-profiles').innerHTML = `
                <div class="stat__icon stat__icon--blue">
                    <i class="fa fa-users"></i>
                </div>
                ${classroomProfiles.length}
            `;
            
            showNotification(`Sala ${currentClassroom}`, `Exibindo perfis da sala ${currentClassroom}`, 'info');
        });
    });
    
    btn1TDCPF.addEventListener('click', function() {
        showClassroom = true;
        currentClassroom = "1TDCPF";
        const classroomProfiles = profiles.filter(p => p.classroom === currentClassroom);
        
        window.requestAnimationFrame(() => {
            populateProfilesTable(classroomProfiles);
            
            document.getElementById('total-profiles').innerHTML = `
                <div class="stat__icon stat__icon--blue">
                    <i class="fa fa-users"></i>
                </div>
                ${classroomProfiles.length}
            `;
            
            showNotification(`Sala ${currentClassroom}`, `Exibindo perfis da sala ${currentClassroom}`, 'info');
        });
    });
    
    btnHide.addEventListener('click', function() {
        showClassroom = false;
        currentClassroom = "";
        
        window.requestAnimationFrame(() => {
            populateProfilesTable([]);
            
            document.getElementById('total-profiles').innerHTML = `
                <div class="stat__icon stat__icon--blue">
                    <i class="fa fa-users"></i>
                </div>
                0
            `;
            
            showNotification('Sala', 'Perfis ocultados', 'info');
        });
    });
}

function initCharts() {
    const ageData = {
        labels: ['18-19', '20-21', '22-23', '24-25', '26+'],
        datasets: [{
            label: 'Distribuição por Idade',
            data: [12, 8, 5, 1, 1],
            backgroundColor: [
                'rgba(0, 243, 255, 0.7)',
                'rgba(153, 51, 255, 0.7)',
                'rgba(0, 255, 136, 0.7)',
                'rgba(255, 204, 0, 0.7)',
                'rgba(255, 51, 102, 0.7)'
            ],
            borderColor: [
                'rgba(0, 243, 255, 1)',
                'rgba(153, 51, 255, 1)',
                'rgba(0, 255, 136, 1)',
                'rgba(255, 204, 0, 1)',
                'rgba(255, 51, 102, 1)'
            ],
            borderWidth: 1
        }]
    };
    
    const ageChartCtx = document.getElementById('age-chart');
    
    Chart.defaults.font.family = "'Segoe UI', 'Roboto', sans-serif";
    Chart.defaults.color = 'rgba(255,255,255,0.7)';
    Chart.defaults.scale.grid.color = 'rgba(255,255,255,0.05)';
    
    ageChart = new Chart(ageChartCtx, {
        type: 'bar',
        data: ageData,
        options: {
            responsive: true,
            maintainAspectRatio: false,
            animation: {
                duration: 500
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        precision: 0
                    }
                }
            },
            plugins: {
                legend: {
                    display: false
                }
            }
        }
    });
    
    document.getElementById('age-chart-menu').addEventListener('click', function() {
        showNotification('Opções do Gráfico', 'Opções adicionais de visualização do gráfico', 'info');
    });
    
    document.getElementById('activity-menu').addEventListener('click', function() {
        showNotification('Opções de Atividade', 'Filtrar ou exportar atividades recentes', 'info');
    });
    
    document.getElementById('profiles-table-menu').addEventListener('click', function() {
        showNotification('Opções da Tabela', 'Exportar ou imprimir lista de perfis', 'info');
    });
    
    document.getElementById('network-menu').addEventListener('click', function() {
        showNotification('Opções de Rede', 'Ajustar visualização do mapa de conexões', 'info');
    });
}

function initNetworkGraph() {
    const canvas = document.getElementById('network-canvas');
    const ctx = canvas.getContext('2d');
    
    const canvasContainer = canvas.parentElement;
    canvas.width = canvasContainer.offsetWidth;
    canvas.height = canvasContainer.offsetHeight;
    
    const loading = document.getElementById('network-loading');
    loading.classList.add('active');
    
    setTimeout(() => {
        loading.classList.remove('active');
        
        const nodes = [];
        let selectedProfiles = [];
        
        if (currentClassroom) {
            selectedProfiles = profiles.filter(p => p.classroom === currentClassroom);
        } else {
            selectedProfiles = profiles.filter(p => p.id <= 15);
        }
        
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        const radius = Math.min(canvas.width, canvas.height) * 0.4;
        
        selectedProfiles.forEach((profile, index) => {
            const angle = (index / selectedProfiles.length) * Math.PI * 2;
            const x = centerX + Math.cos(angle) * radius;
            const y = centerY + Math.sin(angle) * radius;
            
            nodes.push({
                id: profile.id,
                x: x,
                y: y,
                radius: 15,
                color: profile.gender === 'F' ? '#ff00a5' : '#00f3ff',
                name: profile.name,
                rm: profile.rm,
                cpf: profile.cpf,
                birth: profile.birth,
                connections: relationships.filter(r => r.source === profile.id || r.target === profile.id).length
            });
        });
        
        const edges = [];
        
        relationships.forEach(rel => {
            const sourceNode = nodes.find(n => n.id === rel.source);
            const targetNode = nodes.find(n => n.id === rel.target);
            
            if (sourceNode && targetNode) {
                let color;
                switch(rel.type) {
                    case 'family':
                        color = '#00f3ff';
                        break;
                    case 'school':
                        color = '#9933ff';
                        break;
                    case 'friend':
                        color = '#00ff88';
                        break;
                    default:
                        color = 'rgba(255, 255, 255, 0.3)';
                }
                
                edges.push({
                    source: sourceNode,
                    target: targetNode,
                    color: color
                });
            }
        });
        
        function applyForces() {
            const updates = [];
            
            for (let i = 0; i < nodes.length; i++) {
                let forceX = 0, forceY = 0;
                
                for (let j = 0; j < nodes.length; j++) {
                    if (i === j) continue;
                    
                    const nodeA = nodes[i];
                    const nodeB = nodes[j];
                    
                    const dx = nodeB.x - nodeA.x;
                    const dy = nodeB.y - nodeA.y;
                    const distance = Math.sqrt(dx * dx + dy * dy) || 0.1;
                    
                    if (distance < 100) {
                        const force = 1 / distance * 3;
                        forceX -= dx / distance * force;
                        forceY -= dy / distance * force;
                    }
                }
                
                updates.push({ index: i, forceX, forceY });
            }
            
            updates.forEach(update => {
                nodes[update.index].x += update.forceX;
                nodes[update.index].y += update.forceY;
            });
            
            edges.forEach(edge => {
                const dx = edge.target.x - edge.source.x;
                const dy = edge.target.y - edge.source.y;
                const distance = Math.sqrt(dx * dx + dy * dy) || 0.1;
                
                if (distance > 60) {
                    const force = (distance - 60) / 1000;
                    const forceX = dx * force;
                    const forceY = dy * force;
                    
                    edge.source.x += forceX;
                    edge.source.y += forceY;
                    edge.target.x -= forceX;
                    edge.target.y -= forceY;
                }
            });
            
            nodes.forEach(node => {
                if (node.x < node.radius) node.x = node.radius;
                if (node.x > canvas.width - node.radius) node.x = canvas.width - node.radius;
                if (node.y < node.radius) node.y = node.radius;
                if (node.y > canvas.height - node.radius) node.y = canvas.height - node.radius;
            });
        }
        
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            edges.forEach(edge => {
                ctx.beginPath();
                ctx.moveTo(edge.source.x, edge.source.y);
                ctx.lineTo(edge.target.x, edge.target.y);
                ctx.strokeStyle = edge.color;
                ctx.lineWidth = 2;
                ctx.stroke();
            });
            
            nodes.forEach(node => {
                ctx.beginPath();
                ctx.arc(node.x, node.y, node.radius, 0, Math.PI * 2);
                ctx.fillStyle = node.color;
                ctx.fill();
                
                ctx.beginPath();
                ctx.arc(node.x, node.y, node.radius - 3, 0, Math.PI * 2);
                ctx.fillStyle = '#121725';
                ctx.fill();
                
                ctx.font = 'bold 12px Arial';
                ctx.fillStyle = '#ffffff';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(node.name.charAt(0), node.x, node.y);
            });
        }
        
        const nodeInfo = document.getElementById('node-info');
        let hoveredNode = null;
        
        const isMobile = 'ontouchstart' in window;
        
        if (isMobile) {
            canvas.addEventListener('touchstart', function(event) {
                event.preventDefault();
                const touch = event.touches[0];
                checkHover(touch.clientX, touch.clientY);
            });
            
            canvas.addEventListener('touchmove', function(event) {
                event.preventDefault();
                const touch = event.touches[0];
                checkHover(touch.clientX, touch.clientY);
            });
            
            canvas.addEventListener('touchend', function() {
                if (hoveredNode) {
                    const profileId = hoveredNode.id;
                    openProfileModal(profileId);
                }
                nodeInfo.style.display = 'none';
                hoveredNode = null;
            });
        } else {
            canvas.addEventListener('mousemove', function(event) {
                checkHover(event.clientX, event.clientY);
            });
            
            canvas.addEventListener('mouseleave', function() {
                nodeInfo.style.display = 'none';
                hoveredNode = null;
            });
            
            canvas.addEventListener('click', function(event) {
                if (hoveredNode) {
                    const profileId = hoveredNode.id;
                    openProfileModal(profileId);
                }
            });
        }
        
        function checkHover(clientX, clientY) {
            const rect = canvas.getBoundingClientRect();
            const x = clientX - rect.left;
            const y = clientY - rect.top;
            
            hoveredNode = null;
            
            for (let i = 0; i < nodes.length; i++) {
                const node = nodes[i];
                const dx = x - node.x;
                const dy = y - node.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < node.radius) {
                    hoveredNode = node;
                    break;
                }
            }
            
            if (hoveredNode) {
                nodeInfo.style.display = 'block';
                
                let leftPos = clientX + 10;
                let topPos = clientY + 10;
                
                const infoWidth = nodeInfo.offsetWidth;
                const infoHeight = nodeInfo.offsetHeight;
                const windowWidth = window.innerWidth;
                const windowHeight = window.innerHeight;
                
                if (leftPos + infoWidth > windowWidth) {
                    leftPos = clientX - infoWidth - 10;
                }
                
                if (topPos + infoHeight > windowHeight) {
                    topPos = clientY - infoHeight - 10;
                }
                
                nodeInfo.style.left = leftPos + 'px';
                nodeInfo.style.top = topPos + 'px';
                
                document.getElementById('node-name').textContent = hoveredNode.name;
                document.getElementById('node-rm').textContent = hoveredNode.rm;
                document.getElementById('node-cpf').textContent = hoveredNode.cpf;
                document.getElementById('node-birth').textContent = hoveredNode.birth;
                document.getElementById('node-connections').textContent = hoveredNode.connections;
            } else {
                nodeInfo.style.display = 'none';
            }
        }
        
        let animationFrameId;
        
        function animate() {
            applyForces();
            draw();
            animationFrameId = requestAnimationFrame(animate);
        }
        
        animate();
        
        const resizeHandler = function() {
            canvas.width = canvasContainer.offsetWidth;
            canvas.height = canvasContainer.offsetHeight;
            
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            
            nodes.forEach((node, i) => {
                const angle = (i / nodes.length) * Math.PI * 2;
                const radius = Math.min(canvas.width, canvas.height) * 0.4;
                node.x = centerX + Math.cos(angle) * radius;
                node.y = centerY + Math.sin(angle) * radius;
            });
        };
        
        window.addEventListener('resize', resizeHandler);
        
        return function cleanup() {
            window.removeEventListener('resize', resizeHandler);
            cancelAnimationFrame(animationFrameId);
        };
    }, 500);
}

function initConnectionGraph(profileId) {
    const canvas = document.getElementById('connection-canvas');
    const ctx = canvas.getContext('2d');
    
    const canvasContainer = canvas.parentElement;
    canvas.width = canvasContainer.offsetWidth;
    canvas.height = canvasContainer.offsetHeight;
    
    const centerNode = {
        id: parseInt(profileId),
        x: canvas.width / 2,
        y: canvas.height / 2,
        radius: 25,
        color: '#00f3ff',
        fixed: true
    };
    
    const nodes = [centerNode];
    
    const profileRelationships = relationships.filter(rel => 
        rel.source === centerNode.id || rel.target === centerNode.id
    );
    
    profileRelationships.forEach((rel, index) => {
        const connectedId = rel.source === centerNode.id ? rel.target : rel.source;
        const connectedProfile = profiles.find(p => p.id === connectedId);
        
        if (connectedProfile) {
            const angle = (index / profileRelationships.length) * Math.PI * 2;
            const distance = 120;
            
            let color;
            switch(rel.type) {
                case 'family':
                    color = '#00f3ff';
                    break;
                case 'school':
                    color = '#9933ff';
                    break;
                case 'friend':
                    color = '#00ff88';
                    break;
                default:
                    color = 'rgba(255,255,255,0.3)';
            }
            
            nodes.push({
                id: connectedProfile.id,
                x: centerNode.x + Math.cos(angle) * distance,
                y: centerNode.y + Math.sin(angle) * distance,
                radius: 20,
                color: color,
                name: connectedProfile.name,
                type: rel.type
            });
        }
    });
    
    const edges = [];
    
    nodes.forEach(node => {
        if (node.id !== centerNode.id) {
            edges.push({
                source: centerNode,
                target: node,
                color: node.color
            });
        }
    });
    
    function applyForces() {
        nodes.forEach((node, i) => {
            if (node.fixed) return;
            
            for (let j = 0; j < nodes.length; j++) {
                if (i === j || nodes[j].fixed) continue;
                
                const dx = node.x - nodes[j].x;
                const dy = node.y - nodes[j].y;
                const distance = Math.sqrt(dx * dx + dy * dy) || 0.1;
                
                if (distance < 60) {
                    const force = 1 / distance * 2;
                    node.x += dx / distance * force;
                    node.y += dy / distance * force;
                }
            }
            
            if (node.x < node.radius) node.x = node.radius;
            if (node.x > canvas.width - node.radius) node.x = canvas.width - node.radius;
            if (node.y < node.radius) node.y = node.radius;
            if (node.y > canvas.height - node.radius) node.y = canvas.height - node.radius;
        });
        
        edges.forEach(edge => {
            if (edge.source.fixed && edge.target.fixed) return;
            
            const dx = edge.target.x - edge.source.x;
            const dy = edge.target.y - edge.source.y;
            const distance = Math.sqrt(dx * dx + dy * dy) || 0.1;
            
            const idealDistance = 120;
            
            if (Math.abs(distance - idealDistance) > 10) {
                const force = (distance - idealDistance) / 500;
                const forceX = dx / distance * force;
                const forceY = dy / distance * force;
                
                if (!edge.source.fixed) {
                    edge.source.x += forceX;
                    edge.source.y += forceY;
                }
                
                if (!edge.target.fixed) {
                    edge.target.x -= forceX;
                    edge.target.y -= forceY;
                }
            }
        });
    }
    
    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        edges.forEach(edge => {
            ctx.beginPath();
            ctx.moveTo(edge.source.x, edge.source.y);
            ctx.lineTo(edge.target.x, edge.target.y);
            ctx.strokeStyle = edge.color;
            ctx.lineWidth = 2;
            ctx.stroke();
        });
        
        nodes.forEach(node => {
            ctx.beginPath();
            ctx.arc(node.x, node.y, node.radius, 0, Math.PI * 2);
            ctx.fillStyle = node.color;
            ctx.fill();
            
            ctx.beginPath();
            ctx.arc(node.x, node.y, node.radius - 3, 0, Math.PI * 2);
            ctx.fillStyle = '#121725';
            ctx.fill();
            
            ctx.font = 'bold 12px Arial';
            ctx.fillStyle = '#ffffff';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(node.id === centerNode.id ? 'P' : node.name.charAt(0), node.x, node.y);
            
            if (node.id !== centerNode.id) {
                let label;
                switch(node.type) {
                    case 'family':
                        label = 'Família';
                        break;
                    case 'school':
                        label = 'Escola';
                        break;
                    case 'friend':
                        label = 'Amigo';
                        break;
                    default:
                        label = 'Conexão';
                }
                
                ctx.font = '10px Arial';
                ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
                ctx.fillText(label, node.x, node.y + node.radius + 12);
            }
        });
    }
    
    const isMobile = 'ontouchstart' in window;
    
    if (isMobile) {
        canvas.addEventListener('touchstart', function(event) {
            event.preventDefault();
            const touch = event.touches[0];
            checkNodeClick(touch.clientX, touch.clientY);
        });
    } else {
        canvas.addEventListener('click', function(event) {
            checkNodeClick(event.clientX, event.clientY);
        });
    }
    
    function checkNodeClick(clientX, clientY) {
        const rect = canvas.getBoundingClientRect();
        const x = clientX - rect.left;
        const y = clientY - rect.top;
        
        for (let i = 0; i < nodes.length; i++) {
            const node = nodes[i];
            if (node.id === centerNode.id) continue;
            
            const dx = x - node.x;
            const dy = y - node.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            
            if (distance < node.radius) {
                openProfileModal(node.id);
                break;
            }
        }
    }
    
    updateConnectionsTable(profileId);
    
    let animationFrameId;
    
    function animate() {
        applyForces();
        draw();
        animationFrameId = requestAnimationFrame(animate);
    }
    
    animate();
    
    const resizeHandler = function() {
        canvas.width = canvasContainer.offsetWidth;
        canvas.height = canvasContainer.offsetHeight;
        
        centerNode.x = canvas.width / 2;
        centerNode.y = canvas.height / 2;
        
        const connectedNodes = nodes.filter(node => node.id !== centerNode.id);
        connectedNodes.forEach((node, i) => {
            const angle = (i / connectedNodes.length) * Math.PI * 2;
            const distance = 120;
            node.x = centerNode.x + Math.cos(angle) * distance;
            node.y = centerNode.y + Math.sin(angle) * distance;
        });
    };
    
    window.addEventListener('resize', resizeHandler);
    
    return function cleanup() {
        window.removeEventListener('resize', resizeHandler);
        cancelAnimationFrame(animationFrameId);
    };
}

function updateConnectionsTable(profileId) {
    const connectionsTable = document.getElementById('connections-table');
    connectionsTable.innerHTML = '';
    
    const profileRelationships = relationships.filter(rel => 
        rel.source == profileId || rel.target == profileId
    );
    
    if (profileRelationships.length === 0) {
        const emptyRow = document.createElement('tr');
        emptyRow.innerHTML = `
            <td colspan="4" style="text-align: center; color: rgba(255,255,255,0.5);">
                Nenhuma conexão encontrada para este perfil.
            </td>
        `;
        connectionsTable.appendChild(emptyRow);
        return;
    }
    
    const fragment = document.createDocumentFragment();
    
    profileRelationships.forEach(rel => {
        const connectedId = rel.source == profileId ? rel.target : rel.source;
        const connectedProfile = profiles.find(p => p.id == connectedId);
        
        if (connectedProfile) {
            const row = document.createElement('tr');
            
            let typeLabel, typeClass;
            switch(rel.type) {
                case 'family':
                    typeLabel = 'Família';
                    typeClass = 'blue';
                    break;
                case 'school':
                    typeLabel = 'Escola';
                    typeClass = 'purple';
                    break;
                case 'friend':
                    typeLabel = 'Amigos';
                    typeClass = 'green';
                    break;
                default:
                    typeLabel = 'Outro';
                    typeClass = '';
            }
            
            row.innerHTML = `
                <td>${connectedProfile.name}</td>
                <td><span class="badge badge--${typeClass}">${typeLabel}</span></td>
                <td>Alta</td>
                <td>03/06/2025</td>
            `;
            
            fragment.appendChild(row);
        }
    });
    
    connectionsTable.appendChild(fragment);
}

function applyFilters() {
    let filteredProfiles = [...profiles];
    
    if (currentClassroom) {
        filteredProfiles = filteredProfiles.filter(profile => profile.classroom === currentClassroom);
    } else {
        filteredProfiles = [];
        document.getElementById('total-profiles').innerHTML = `
            <div class="stat__icon stat__icon--blue">
                <i class="fa fa-users"></i>
            </div>
            0
        `;
        populateProfilesTable(filteredProfiles);
        return;
    }
    
    if (activeFilters.status !== 'all') {
        filteredProfiles = filteredProfiles.filter(profile => profile.status === activeFilters.status);
    }
    
    if (activeFilters.gender !== 'all') {
        filteredProfiles = filteredProfiles.filter(profile => profile.gender === activeFilters.gender);
    }
    
    if (activeFilters.age !== 'all') {
        filteredProfiles = filteredProfiles.filter(profile => {
            const age = calculateAge(profile.birth);
            if (!age) return false;
            
            switch (activeFilters.age) {
                case '18-19':
                    return age >= 18 && age <= 19;
                case '20-21':
                    return age >= 20 && age <= 21;
                case '22-23':
                    return age >= 22 && age <= 23;
                case '24+':
                    return age >= 24;
                default:
                    return true;
            }
        });
    }
    
    if (activeFilters.search) {
        const searchTerm = activeFilters.search.toLowerCase();
        filteredProfiles = filteredProfiles.filter(profile => 
            profile.name.toLowerCase().includes(searchTerm) ||
            profile.rm.toLowerCase().includes(searchTerm) ||
            profile.cpf.toLowerCase().includes(searchTerm) ||
            (profile.mother && profile.mother.toLowerCase().includes(searchTerm))
        );
    }
    
    window.requestAnimationFrame(() => {
        populateProfilesTable(filteredProfiles);
        
        document.getElementById('total-profiles').innerHTML = `
            <div class="stat__icon stat__icon--blue">
                <i class="fa fa-users"></i>
            </div>
            ${filteredProfiles.length}
        `;
    });
}

function initProfileModal() {
    const profileModal = document.getElementById('profile-modal');
    const profileModalClose = document.getElementById('profile-modal-close');
    
    profileModalClose.addEventListener('click', function() {
        profileModal.classList.remove('active');
    });
    
    const tabs = document.querySelectorAll('.tab');
    
    tabs.forEach(tab => {
        tab.addEventListener('click', function() {
            const tabId = this.getAttribute('data-tab');
            
            tabs.forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            this.classList.add('active');
            document.getElementById(`${tabId}-tab`).classList.add('active');
        });
    });
}

function openProfileModal(profileId) {
    currentProfileId = profileId;
    const profile = profiles.find(p => p.id == profileId);
    
    if (profile) {
        document.getElementById('profile-name').textContent = profile.name;
        document.getElementById('profile-rm').textContent = profile.rm;
        document.getElementById('profile-birth').textContent = profile.birth;
        document.getElementById('profile-cpf').textContent = profile.cpf;
        document.getElementById('profile-password').textContent = profile.password;
        document.getElementById('profile-mother').textContent = profile.mother;
        
        const statusEl = document.getElementById('profile-status');
        statusEl.innerHTML = '';
        const statusSpan = document.createElement('span');
        statusSpan.className = `data-table__status data-table__status--${profile.status}`;
        statusSpan.textContent = profile.status === 'active' ? 'Verificado' : 
                               profile.status === 'pending' ? 'Pendente' : 'Inativo';
        statusEl.appendChild(statusSpan);
        
        const profileImage = document.getElementById('profile-image');
        profileImage.textContent = profile.name.charAt(0);
        
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.querySelector('.tab[data-tab="connections"]').classList.add('active');
        document.getElementById('connections-tab').classList.add('active');
        
        document.getElementById('profile-modal').classList.add('active');
        
        setTimeout(() => {
            initConnectionGraph(profileId);
        }, 50);
    }
}

function populateProfilesTable(data) {
    const tableBody = document.querySelector('#profiles-table tbody');
    
    tableBody.innerHTML = '';
    
    if (data.length === 0) {
        const emptyRow = document.createElement('tr');
        emptyRow.innerHTML = `
            <td colspan="8" style="text-align: center; color: rgba(255,255,255,0.5);">
                Nenhum perfil encontrado com os critérios selecionados.
            </td>
        `;
        tableBody.appendChild(emptyRow);
        return;
    }
    
    const fragment = document.createDocumentFragment();
    
    data.forEach(profile => {
        const row = document.createElement('tr');
        row.classList.add('profile-row');
        row.setAttribute('data-id', profile.id);
        
        let statusText = '';
        switch(profile.status) {
            case 'active':
                statusText = 'Verificado';
                break;
            case 'pending':
                statusText = 'Pendente';
                break;
            case 'inactive':
                statusText = 'Inativo';
                break;
        }
        
        row.innerHTML = `
            <td>${profile.name}</td>
            <td>${profile.rm}</td>
            <td>${profile.birth}</td>
            <td>${profile.cpf}</td>
            <td>${profile.password}</td>
            <td>${profile.mother}</td>
            <td><span class="data-table__status data-table__status--${profile.status}">${statusText}</span></td>
            <td>
                <div class="data-table__actions">
                    <div class="data-table__action edit-profile" data-id="${profile.id}">
                        <i class="fa fa-edit"></i>
                    </div>
                    <div class="data-table__action view-profile" data-id="${profile.id}">
                        <i class="fa fa-user"></i>
                    </div>
                </div>
            </td>
        `;
        
        fragment.appendChild(row);
    });
    
    tableBody.appendChild(fragment);
    
    document.querySelectorAll('.view-profile').forEach(button => {
        button.addEventListener('click', function() {
            const profileId = this.getAttribute('data-id');
            openProfileModal(profileId);
        });
    });
    
    document.querySelectorAll('.edit-profile').forEach(button => {
        button.addEventListener('click', function() {
            const profileId = this.getAttribute('data-id');
            showNotification('Edição de perfil', `Editando perfil ID ${profileId}`, 'info');
        });
    });
}

function showNotification(title, message, type) {
    const notification = document.getElementById('notification');
    const notificationIcon = notification.querySelector('.notification__icon');
    const notificationTitle = notification.querySelector('.notification__title');
    const notificationMessage = notification.querySelector('.notification__message');
    
    notificationIcon.style.background = '';
    notificationIcon.style.color = '';
    
    switch(type) {
        case 'success':
            notificationIcon.style.background = 'rgba(0, 255, 136, 0.1)';
            notificationIcon.style.color = 'var(--success)';
            notificationIcon.innerHTML = '<i class="fa fa-check"></i>';
            break;
        case 'warning':
            notificationIcon.style.background = 'rgba(255, 204, 0, 0.1)';
            notificationIcon.style.color = 'var(--warning)';
            notificationIcon.innerHTML = '<i class="fa fa-warning"></i>';
            break;
        case 'error':
            notificationIcon.style.background = 'rgba(255, 51, 102, 0.1)';
            notificationIcon.style.color = 'var(--danger)';
            notificationIcon.innerHTML = '<i class="fa fa-warning"></i>';
            break;
        default:
            notificationIcon.style.background = 'rgba(0, 243, 255, 0.1)';
            notificationIcon.style.color = 'var(--primary)';
            notificationIcon.innerHTML = '<i class="fa fa-info"></i>';
    }
    
    notificationTitle.textContent = title;
    notificationMessage.textContent = message;
    
    if (notification.timeoutId) {
        clearTimeout(notification.timeoutId);
    }
    
    notification.classList.add('active');
    
    notification.timeoutId = setTimeout(() => {
        notification.classList.remove('active');
    }, 4000);
}

function initBackgroundAnimation() {
    createRaindrops();
}

document.addEventListener('DOMContentLoaded', function() {
    createRaindrops();
    
    const preloader = document.querySelector('.preloader');
    const preloaderBar = document.getElementById('preloader-bar');
    const authStatus = document.getElementById('auth-status');
    
    authStatus.textContent = 'Sistema pronto!';
    authStatus.style.color = '#00ff88';
    
    setTimeout(() => {
        let progress = 0;
        const interval = setInterval(() => {
            progress += Math.random() * 20;
            if (progress > 100) {
                progress = 100;
                clearInterval(interval);
                
                setTimeout(() => {
                    preloaderBar.style.width = '100%';
                    preloaderBar.style.backgroundColor = '#00ff88';
                    
                    preloader.style.opacity = '0';
                    setTimeout(() => {
                        preloader.style.display = 'none';
                        initSystem();
                    }, 300);
                }, 100);
            }
            
            preloaderBar.style.width = `${progress}%`;
        }, 100);
    }, 500);
    
    initGlobalEvents();
    
    document.querySelectorAll('.edit-profile').forEach(button => { 
        button.addEventListener('click', function() {
            const profileId = this.getAttribute('data-id');
            showNotification('Modo de edição', 'Editando perfil ID: ' + profileId, 'info');
        }); 
    });
    
    setTimeout(function() {
        if (window.innerWidth <= 768) {
            showNotification('Bem-vindo', 'Sistema MK-OSINT inicializado com sucesso', 'success');
        }
    }, 800);
});
    </script>
</body>
</html>
